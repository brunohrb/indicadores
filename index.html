<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TEXNET - Dashboard Financeiro</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <style>
    :root {
      --primary: #2563eb; --success: #10b981; --warning: #f59e0b;
      --danger: #ef4444; --info: #06b6d4; --bg-primary: #ffffff;
      --bg-secondary: #f8fafc; --text-primary: #1e293b;
      --text-secondary: #64748b; --sidebar-bg: #1e293b;
      --sidebar-width: 260px; --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1); --radius-lg: 12px;
    }
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif; background:var(--bg-secondary); color:var(--text-primary); line-height:1.6; }
    .sidebar { position:fixed; left:0; top:0; width:var(--sidebar-width); height:100vh; background:var(--sidebar-bg); display:flex; flex-direction:column; z-index:1000; }
    .sidebar-header { padding:1.5rem; border-bottom:1px solid rgba(255,255,255,0.1); }
    .logo { display:flex; align-items:center; gap:0.75rem; color:white; font-size:1.25rem; font-weight:700; }
    .logo-icon { font-size:2rem; }
    .sidebar-nav { flex:1; padding:1rem; overflow-y:auto; }
    .nav-item { display:flex; align-items:center; gap:0.75rem; padding:0.75rem 1rem; color:#cbd5e1; border-radius:8px; margin-bottom:0.25rem; cursor:pointer; transition:all 0.3s; }
    .nav-item:hover { background:#334155; color:white; }
    .nav-item.active { background:var(--primary); color:white; }
    .nav-icon { font-size:1.25rem; }
    .sidebar-footer { padding:1rem 1.5rem; border-top:1px solid rgba(255,255,255,0.1); font-size:0.875rem; color:#cbd5e1; }
    .main-content { margin-left:var(--sidebar-width); min-height:100vh; }
    .header { background:var(--bg-primary); padding:1.5rem 2rem; box-shadow:var(--shadow-sm); position:sticky; top:0; z-index:100; }
    .header-top { display:flex; justify-content:space-between; align-items:center; margin-bottom:1rem; }
    .page-title { font-size:1.5rem; font-weight:600; }
    .page-subtitle { font-size:0.875rem; color:var(--text-secondary); margin-top:0.25rem; }
    .filters-container { display:flex; gap:1rem; align-items:center; flex-wrap:wrap; }
    .filter-group { display:flex; align-items:center; gap:0.5rem; }
    .filter-label { font-size:0.875rem; color:var(--text-secondary); font-weight:500; }
    select, input[type="month"] { padding:0.5rem 1rem; border:1px solid #e2e8f0; border-radius:8px; font-size:0.875rem; background:white; cursor:pointer; transition:all 0.3s; }
    select:focus, input[type="month"]:focus { outline:none; border-color:var(--primary); box-shadow:0 0 0 3px rgba(37,99,235,0.1); }
    .btn { padding:0.5rem 1rem; border:none; border-radius:8px; font-size:0.875rem; font-weight:500; cursor:pointer; transition:all 0.3s; }
    .btn-primary { background:var(--primary); color:white; }
    .btn-primary:hover { background:#1d4ed8; }
    .badge { padding:0.5rem 1rem; border-radius:20px; font-size:0.875rem; font-weight:600; display:inline-flex; align-items:center; gap:0.5rem; }
    .badge-success { background:#dcfce7; color:#166534; }
    .content { padding:2rem; }
    .stats-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(280px,1fr)); gap:1.5rem; margin-bottom:2rem; }
    .stat-card { background:var(--bg-primary); padding:1.5rem; border-radius:var(--radius-lg); box-shadow:var(--shadow-sm); transition:all 0.3s; position:relative; overflow:hidden; }
    .stat-card:hover { box-shadow:var(--shadow-md); transform:translateY(-2px); }
    .stat-card::before { content:''; position:absolute; top:0; left:0; width:4px; height:100%; background:var(--card-color); }
    .stat-header { display:flex; justify-content:space-between; align-items:flex-start; margin-bottom:1rem; }
    .stat-title { font-size:0.875rem; color:var(--text-secondary); font-weight:500; }
    .stat-icon { width:48px; height:48px; border-radius:12px; display:flex; align-items:center; justify-content:center; font-size:1.5rem; }
    .stat-value { font-size:2rem; font-weight:700; margin-bottom:0.5rem; }
    .stat-footer { display:flex; justify-content:space-between; align-items:center; font-size:0.875rem; }
    .stat-change.positive { color:var(--success); }
    .stat-change.negative { color:var(--danger); }
    .tabs { display:flex; gap:0.5rem; margin-bottom:1.5rem; border-bottom:2px solid #e2e8f0; flex-wrap:wrap; }
    .tab-btn { padding:0.75rem 1.5rem; background:none; border:none; border-bottom:2px solid transparent; margin-bottom:-2px; font-size:0.875rem; font-weight:500; color:var(--text-secondary); cursor:pointer; transition:all 0.3s; }
    .tab-btn:hover { color:var(--primary); }
    .tab-btn.active { color:var(--primary); border-bottom-color:var(--primary); }
    .chart-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(450px,1fr)); gap:1.5rem; margin-bottom:2rem; }
    .chart-card { background:var(--bg-primary); padding:1.5rem; border-radius:var(--radius-lg); box-shadow:var(--shadow-sm); }
    .chart-header { margin-bottom:1.5rem; }
    .chart-title { font-size:1.125rem; font-weight:600; }
    .chart-subtitle { font-size:0.875rem; color:var(--text-secondary); margin-top:0.25rem; }
    .chart-container { position:relative; height:300px; }
    .table-container { background:var(--bg-primary); border-radius:var(--radius-lg); box-shadow:var(--shadow-sm); overflow:hidden; margin-bottom:2rem; }
    .table-header { padding:1.5rem; border-bottom:1px solid #e2e8f0; display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:1rem; }
    .table-title { font-size:1.125rem; font-weight:600; }
    #tableContent, #indicadoresTableContent { overflow-x:auto; }
    table { width:100%; border-collapse:collapse; min-width:1400px; }
    thead { background:var(--bg-secondary); }
    th { padding:1rem; text-align:left; font-size:0.875rem; font-weight:600; color:var(--text-secondary); text-transform:uppercase; letter-spacing:0.05em; white-space:nowrap; }
    th:first-child, td:first-child { position:sticky; left:0; background:var(--bg-primary); z-index:10; min-width:200px; }
    thead th:first-child { background:var(--bg-secondary); z-index:15; }
    td { padding:1rem; border-bottom:1px solid #e2e8f0; font-size:0.875rem; }
    tr:hover { background:var(--bg-secondary); }
    .value-cell { text-align:right; font-variant-numeric:tabular-nums; }
    .negative-value { color:var(--danger); }
    .positive-value { color:var(--success); }
    .total-row { background:var(--bg-secondary); font-weight:600; }
    .total-row td { padding:1.25rem 1rem; border-bottom:3px solid var(--primary); }
    .total-row td:first-child { background:var(--bg-secondary); }
    .category-row { background:#f1f5f9; font-weight:600; cursor:pointer; user-select:none; }
    .category-row:hover { background:#e2e8f0; }
    .category-row td:first-child { background:#f1f5f9; }
    .expand-icon { display:inline-block; width:16px; height:16px; transition:transform 0.2s; }
    .expand-icon.expanded { transform:rotate(90deg); }
    .sub-item { background:white; }
    .sub-item.hidden { display:none; }
    .sub-item td:first-child { padding-left:3rem; background:white; }
    .view-container { display:none; }
    .view-container.active { display:block; }
    .year-btn { padding:0.75rem 1.5rem; border:2px solid #e2e8f0; background:white; border-radius:8px; cursor:pointer; font-weight:500; transition:all 0.3s; }
    .year-btn:hover { border-color:var(--primary); }
    .year-btn.active { background:var(--primary); color:white; border-color:var(--primary); }
    .comparison-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:1.5rem; margin-bottom:2rem; }
    .comparison-card { background:var(--bg-primary); padding:1.5rem; border-radius:var(--radius-lg); box-shadow:var(--shadow-sm); }
    .comparison-card-title { font-size:1rem; font-weight:600; margin-bottom:1rem; }
    .comparison-item { display:flex; justify-content:space-between; align-items:center; padding:0.75rem 0; border-bottom:1px solid #e2e8f0; }
    .comparison-item:last-child { border-bottom:none; }
    .comparison-label { font-size:0.875rem; color:var(--text-secondary); }
    .comparison-value { font-weight:600; text-align:right; }
    .comparison-value.positive { color:var(--success); }
    .comparison-value.negative { color:var(--danger); }
    .comparison-variation { font-size:0.75rem; margin-top:0.25rem; color:var(--text-secondary); }
    .positive { background:rgba(16,185,129,0.05); }
    .negative { background:rgba(239,68,68,0.05); }
    .modal-overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); z-index:2000; justify-content:center; align-items:center; }
    .modal-overlay.active { display:flex; }
    .modal-content { background:white; width:98%; max-width:2000px; max-height:95vh; border-radius:16px; overflow:hidden; display:flex; flex-direction:column; }
    .modal-header { padding:1.5rem 2rem; background:linear-gradient(135deg,var(--primary),#1d4ed8); color:white; display:flex; justify-content:space-between; align-items:center; }
    .modal-title { font-size:1.5rem; font-weight:700; }
    .modal-close { background:rgba(255,255,255,0.2); border:none; color:white; width:40px; height:40px; border-radius:50%; cursor:pointer; font-size:1.5rem; display:flex; align-items:center; justify-content:center; }
    .modal-body { padding:2rem; overflow-y:auto; flex:1; }
    .consolidado-filtro { display:flex; align-items:center; gap:0.75rem; margin-bottom:1.5rem; }
    .consolidado-filtro label { font-size:0.875rem; font-weight:500; color:var(--text-secondary); }
    .btn-detalhar { background:var(--primary); color:white; border:none; padding:0.35rem 0.75rem; border-radius:6px; font-size:0.75rem; font-weight:500; cursor:pointer; margin-left:0.5rem; display:inline-flex; align-items:center; gap:0.25rem; }
    .geogrid-container { width:100%; height:calc(100vh - 140px); background:white; border-radius:12px; overflow:hidden; position:relative; }
    .geogrid-header { padding:1.5rem 2rem; display:flex; align-items:center; gap:1rem; }
    .geogrid-icon { font-size:2rem; }
    .geogrid-iframe { width:100%; height:calc(100% - 76px); border:none; }
    .iframe-loading { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; color:#64748b; display:none; }
    .iframe-loading.active { display:block; }
    .loading-spinner { width:50px; height:50px; border:5px solid #e2e8f0; border-top:5px solid #10b981; border-radius:50%; animation:spin 1s linear infinite; margin:0 auto 1rem; }
    @keyframes spin { 0%{transform:rotate(0deg)} 100%{transform:rotate(360deg)} }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="logo"><span class="logo-icon">üìä</span><span>TEXNET</span></div>
    </div>
    <nav class="sidebar-nav">
      <div class="nav-item active" onclick="selectMenu(this,'dashboard')"><span class="nav-icon">üí∞</span><span>Dashboard</span></div>
      <div class="nav-item" onclick="selectMenu(this,'consolidado')"><span class="nav-icon">üìã</span><span>Fluxo de Caixa</span></div>
      <div class="nav-item" onclick="selectMenu(this,'comparativo')"><span class="nav-icon">üìä</span><span>Comparativo Anual</span></div>
      <div class="nav-item" onclick="selectMenu(this,'powerbi')"><span class="nav-icon">üìä</span><span>Relat√≥rio Power BI</span></div>
      <div class="nav-item" onclick="selectMenu(this,'ia-estrategica')"><span class="nav-icon">ü§ñ</span><span>IA Estrat√©gica</span></div>
      <div class="nav-item" onclick="selectMenu(this,'diretoria')"><span class="nav-icon">‚öôÔ∏è</span><span>Par√¢metros</span></div>
      <div class="nav-item" onclick="selectMenu(this,'comissao-financeiro')"><span class="nav-icon">üíº</span><span>Comiss√£o Financeiro</span></div>
    </nav>
    <div class="sidebar-footer">Sistema Financeiro TEXNET<br>¬© 2026 - v3.0</div>
  </div>

  <!-- Main Content -->
  <div class="main-content">
    <div class="header" id="mainHeader">
      <div class="header-top">
        <div><h1 class="page-title">Dashboard Financeiro</h1><p class="page-subtitle">Vis√£o consolidada e fluxo de caixa detalhado</p></div>
        <span class="badge badge-success">‚úì Atualizado</span>
      </div>
      <div class="filters-container">
        <div class="filter-group">
          <label class="filter-label">Visualiza√ß√£o:</label>
          <select id="viewType" onchange="changeView()">
            <option value="dashboard">Dashboard Geral</option>
            <option value="consolidado">Fluxo de Caixa</option>
            <option value="comparativo">Comparativo Anual</option>
            <option value="powerbi">Relat√≥rio Power BI</option>
            <option value="ia-estrategica">IA Estrat√©gica</option>
            <option value="diretoria">Par√¢metros</option>
            <option value="comissao-financeiro">Comiss√£o Financeiro</option>
          </select>
        </div>
        <div class="filter-group">
          <label class="filter-label">Per√≠odo:</label>
          <input type="month" id="periodFilter" value="2026-01" onchange="updatePeriod()">
        </div>
        <button class="btn btn-primary" onclick="applyFilters()">Aplicar</button>
      </div>
    </div>

    <div class="content">
      <!-- Dashboard View -->
      <div id="dashboardView" class="view-container active">
        <div class="stats-grid">
          <div class="stat-card" style="--card-color:var(--success)"><div class="stat-header"><div><div class="stat-title">Receitas Totais</div><div class="stat-value positive-value">R$ 2.720.556,32</div></div><div class="stat-icon" style="background:#dcfce7;color:var(--success)">üí∞</div></div><div class="stat-footer"><span class="stat-change positive">‚Üë 12.5%</span><span style="color:var(--text-secondary)">vs m√™s anterior</span></div></div>
          <div class="stat-card" style="--card-color:var(--danger)"><div class="stat-header"><div><div class="stat-title">Despesas Totais</div><div class="stat-value">R$ 1.888.295,00</div></div><div class="stat-icon" style="background:#fee2e2;color:var(--danger)">üí∏</div></div><div class="stat-footer"><span class="stat-change negative">‚Üë 8.3%</span><span style="color:var(--text-secondary)">vs m√™s anterior</span></div></div>
          <div class="stat-card" style="--card-color:var(--primary)"><div class="stat-header"><div><div class="stat-title">EBITDA Ajustado</div><div class="stat-value positive-value">R$ 844.681,83</div></div><div class="stat-icon" style="background:#dbeafe;color:var(--primary)">üìä</div></div><div class="stat-footer"><span class="stat-change positive">‚Üë 18.2%</span><span style="color:var(--text-secondary)">Margem: 31.0%</span></div></div>
          <div class="stat-card" style="--card-color:var(--warning)"><div class="stat-header"><div><div class="stat-title">EBITDA</div><div class="stat-value">R$ 832.261,35</div></div><div class="stat-icon" style="background:#fef3c7;color:var(--warning)">üíµ</div></div><div class="stat-footer"><span style="color:var(--text-secondary)">Janeiro 2026</span></div></div>
        </div>
        <div class="chart-grid">
          <div class="chart-card"><div class="chart-header"><h3 class="chart-title">Composi√ß√£o das Receitas</h3><p class="chart-subtitle">Distribui√ß√£o por categoria</p></div><div class="chart-container"><canvas id="receitasChart"></canvas></div></div>
          <div class="chart-card"><div class="chart-header"><h3 class="chart-title">Distribui√ß√£o de Despesas</h3><p class="chart-subtitle">Por tipo</p></div><div class="chart-container"><canvas id="despesasChart"></canvas></div></div>
          <div class="chart-card"><div class="chart-header"><h3 class="chart-title">Evolu√ß√£o Mensal 2026</h3><p class="chart-subtitle">Receitas vs Despesas</p></div><div class="chart-container"><canvas id="comparativoReceitasChart"></canvas></div></div>
          <div class="chart-card"><div class="chart-header"><h3 class="chart-title">Top 10 Custos</h3><p class="chart-subtitle">Maiores custos operacionais</p></div><div class="chart-container"><canvas id="custosChart"></canvas></div></div>
        </div>
      </div>

      <!-- Consolidado View -->
      <div id="consolidadoView" class="view-container">
        <div style="display:flex;align-items:center;gap:1rem;padding:2rem 2rem 0;flex-wrap:wrap;margin-bottom:1rem;">
          <h2 style="margin:0;">Fluxo de Caixa - 2026</h2>
          <a href="https://onedrive.live.com/?id=BAF9B60FA66D2B29!s31443c64c5b15a40b66793f9e4bc0c03&cid=BAF9B60FA66D2B29"
             target="_blank"
             style="padding:0.35rem 0.85rem;background:#0078d4;color:white;border-radius:7px;font-size:0.78rem;font-weight:600;text-decoration:none;">
            ‚òÅÔ∏è OneDrive
          </a>
          <label style="padding:0.35rem 0.85rem;background:#059669;color:white;border-radius:7px;font-size:0.78rem;font-weight:600;cursor:pointer;">
            üìÇ Upload XLSX
            <input type="file" id="consolidadoCsvInput" accept=".xlsx,.xls" style="display:none" onchange="consolidadoParseXlsx(this)">
          </label>
          <span id="syncStatusMsg" style="font-size:0.75rem;color:#64748b"></span>
          <div id="syncProgressBar" style="display:none;flex:1;min-width:120px;">
            <div style="background:#e2e8f0;border-radius:99px;height:5px;overflow:hidden;">
              <div id="syncProgressFill" style="background:#059669;height:100%;width:0%;transition:width 0.4s;border-radius:99px;"></div>
            </div>
            <div id="syncProgressMsg" style="font-size:0.72rem;color:#64748b;margin-top:0.2rem;"></div>
          </div>
        </div>
        <div style="padding:0 2rem;">

          <div class="consolidado-filtro" style="flex-wrap:wrap;gap:1rem;">
            <div style="display:flex;align-items:center;gap:0.75rem;">
              <label for="consolidadoPeriodo">Per√≠odo:</label>
              <input type="month" id="consolidadoPeriodo" value="2026-01" onchange="onConsolidadoPeriodoChange()">
            </div>
            <div style="display:flex;align-items:center;gap:0.75rem;">
              <label for="consolidadoAnoFiltro" style="font-size:0.875rem;font-weight:500;color:var(--text-secondary)">Ano (resumo anual):</label>
              <select id="consolidadoAnoFiltro" style="padding:0.4rem 0.7rem;border:1px solid #cbd5e1;border-radius:8px;font-size:0.9rem;color:#1e293b;background:white">
                <option value="2026">2026</option>
                <option value="2025">2025</option>
                <option value="2024">2024</option>
              </select>
            </div>
          </div>
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Detalhamento Financeiro</h3>
              <div class="tabs" style="flex-wrap:wrap;gap:0.4rem;">
                <button class="tab-btn active" onclick="showTab('receitas',this)">Receitas</button>
                <button class="tab-btn" onclick="showTab('impostos',this)">Impostos</button>
                <button class="tab-btn" onclick="showTab('custos',this)">Custos</button>
                <button class="tab-btn" onclick="showTab('despesas',this)">Despesas Operac.</button>
                <button class="tab-btn" onclick="showTab('ebitda',this)">EBITDA</button>
                <button class="tab-btn" onclick="showTab('ajustes',this)">Ajustes de Caixa</button>
                <button class="tab-btn" onclick="showTab('bancos',this)">Bancos</button>
                <button class="btn-detalhar" onclick="abrirModalTudoConsolidado()" style="margin-left:0.5rem;">üìä Ver Tudo Consolidado</button>
                <button class="btn-detalhar" onclick="abrirModalConsolidadoAnual()" style="margin-left:0.25rem;background:linear-gradient(135deg,#7c3aed,#5b21b6);">üìÖ Consolidado Anual</button>
              </div>
            </div>
            <div id="tableContent"></div>
          </div>
        </div>
      </div>

      <!-- Comparativo View -->
      <div id="comparativoView" class="view-container">
        <div style="padding:2rem">
          <h2 style="margin-bottom:1.5rem;">Comparativo Anual</h2>
          <div style="display:flex;gap:1rem;margin-bottom:2rem;">
            <button class="year-btn active" onclick="selectYear(2026,event)">2026</button>
            <button class="year-btn" onclick="selectYear(2025,event)">2025</button>
            <button class="year-btn" onclick="selectYear(2024,event)">2024</button>
          </div>
          <div class="comparison-grid" id="comparisonGrid"></div>
          <div class="table-container">
            <div class="table-header">
              <h3 class="table-title">Detalhamento por Categoria</h3>
              <div class="tabs">
                <button class="tab-btn active" onclick="showCompTab('receitas-comp',this)">Receitas</button>
                <button class="tab-btn" onclick="showCompTab('custos-comp',this)">Custos</button>
                <button class="tab-btn" onclick="showCompTab('despesas-comp',this)">Despesas</button>
                <button class="tab-btn" onclick="showCompTab('ebitda-comp',this)">EBITDA</button>
              </div>
            </div>
            <div id="compTableContent"></div>
          </div>
        </div>
      </div>

      <!-- Indicadores View -->
      <!-- PowerBI View -->
      <div id="powerbiView" class="view-container">
        <div class="geogrid-container" style="margin:2rem">
          <div class="geogrid-header" style="background:linear-gradient(135deg,#f7ba2c,#ea5353);color:white;">
            <span class="geogrid-icon">üìä</span>
            <div><h2 style="margin:0">Relat√≥rio Power BI</h2><p style="margin:0;font-size:0.875rem;opacity:0.9">Dashboard de an√°lise de dados</p></div>
          </div>
          <div class="iframe-loading active" id="pbiLoading"><div class="loading-spinner"></div><p>Carregando...</p></div>
          <iframe class="geogrid-iframe" src="https://app.powerbi.com/reportEmbed?reportId=f4daaf6e-02a4-4702-9fcf-8e5b462d43f7&autoAuth=true&ctid=b6f5c3aa-17cb-4bce-8eb6-8b30b93166e8&actionBarEnabled=true" onload="document.getElementById('pbiLoading').classList.remove('active')" loading="lazy"></iframe>
        </div>
      </div>

      <!-- IA View -->
      <div id="iaEstrategicaView" class="view-container">
        <div style="max-width:1400px;margin:0 auto;padding:2rem">
          <div style="background:linear-gradient(135deg,#667eea,#764ba2);padding:3rem;border-radius:20px;color:white;margin-bottom:2rem;text-align:center"><h1 style="margin:0;font-size:3rem">ü§ñ IA Estrat√©gica</h1><p style="margin:1rem 0 0;font-size:1.25rem;opacity:0.95">An√°lises inteligentes para decis√µes estrat√©gicas</p></div>
          <div class="stats-grid" style="margin-bottom:3rem">
            <div class="stat-card" style="--card-color:#3b82f6;cursor:pointer" onclick="alert('üöß Em desenvolvimento!')"><div class="stat-header"><div><div class="stat-title">An√°lise de Cen√°rio</div><p style="margin:0.5rem 0 0;font-size:0.875rem;color:var(--text-secondary)">An√°lise completa da situa√ß√£o atual</p></div><div class="stat-icon" style="background:#dbeafe;color:#3b82f6;font-size:2rem">üìä</div></div></div>
            <div class="stat-card" style="--card-color:#10b981;cursor:pointer" onclick="alert('üöß Em desenvolvimento!')"><div class="stat-header"><div><div class="stat-title">Montar Estrat√©gias</div><p style="margin:0.5rem 0 0;font-size:0.875rem;color:var(--text-secondary)">Estrat√©gias baseadas em dados hist√≥ricos</p></div><div class="stat-icon" style="background:#d1fae5;color:#10b981;font-size:2rem">üéØ</div></div></div>
            <div class="stat-card" style="--card-color:#f59e0b;cursor:pointer" onclick="alert('üöß Em desenvolvimento!')"><div class="stat-header"><div><div class="stat-title">Or√ßamento Trimestral</div><p style="margin:0.5rem 0 0;font-size:0.875rem;color:var(--text-secondary)">Proje√ß√µes baseadas em per√≠odos anteriores</p></div><div class="stat-icon" style="background:#fef3c7;color:#f59e0b;font-size:2rem">üí∞</div></div></div>
            <div class="stat-card" style="--card-color:#8b5cf6;cursor:pointer" onclick="alert('üöß Em desenvolvimento!')"><div class="stat-header"><div><div class="stat-title">An√°lise do M√™s</div><p style="margin:0.5rem 0 0;font-size:0.875rem;color:var(--text-secondary)">Relat√≥rio mensal com insights autom√°ticos</p></div><div class="stat-icon" style="background:#ede9fe;color:#8b5cf6;font-size:2rem">üìÖ</div></div></div>
            <div class="stat-card" style="--card-color:#06b6d4;cursor:pointer" onclick="alert('üöß Em desenvolvimento!')"><div class="stat-header"><div><div class="stat-title">Previs√µes IA</div><p style="margin:0.5rem 0 0;font-size:0.875rem;color:var(--text-secondary)">Previs√µes de receita, churn e crescimento</p></div><div class="stat-icon" style="background:#cffafe;color:#06b6d4;font-size:2rem">üîÆ</div></div></div>
            <div class="stat-card" style="--card-color:#ef4444;cursor:pointer" onclick="alert('üöß Em desenvolvimento!')"><div class="stat-header"><div><div class="stat-title">Alertas Inteligentes</div><p style="margin:0.5rem 0 0;font-size:0.875rem;color:var(--text-secondary)">Detec√ß√£o autom√°tica de anomalias</p></div><div class="stat-icon" style="background:#fee2e2;color:#ef4444;font-size:2rem">‚ö†Ô∏è</div></div></div>
          </div>
          <div style="background:white;padding:2rem;border-radius:12px;box-shadow:0 4px 15px rgba(0,0,0,0.1)">
            <h3 style="margin:0 0 1rem">‚öôÔ∏è Configura√ß√£o da API OpenAI</h3>
            <div style="display:flex;gap:1rem;align-items:end">
              <div style="flex:1"><label style="display:block;margin-bottom:0.5rem;font-weight:600;font-size:0.875rem">API Key OpenAI</label><input type="password" id="openaiApiKey" placeholder="sk-proj-..." style="width:100%;padding:0.75rem;border:2px solid #e2e8f0;border-radius:8px;font-size:0.875rem"></div>
              <button onclick="salvarApiKey()" style="padding:0.75rem 2rem;background:var(--primary);color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer">üíæ Salvar</button>
            </div>
            <p style="margin:1rem 0 0;font-size:0.75rem;color:#94a3b8">‚ö†Ô∏è Sua chave √© armazenada localmente no navegador.</p>
          </div>
        </div>
      </div>
      <!-- Par√¢metros View -->
      <div id="diretoriaView" class="view-container" style="display:none">
    <div style="max-width:1200px;margin:0 auto;padding:2rem">

      <!-- Header -->
      <div style="background:linear-gradient(135deg,#1e3a8a,#2563eb);padding:2.5rem;border-radius:20px;color:white;margin-bottom:2rem;text-align:center">
        <h1 style="margin:0;font-size:2.5rem">‚öôÔ∏è Par√¢metros</h1>
        <p style="margin:0.75rem 0 0;font-size:1.1rem;opacity:0.92">Central de √≠ndices, metas e par√¢metros ‚Äî base para gr√°ficos, indicadores e c√°lculos autom√°ticos</p>
      </div>

      <!-- SE√á√ÉO 1: Carregar PDF da Diretoria -->
      <div style="background:white;border-radius:16px;padding:2rem;box-shadow:0 4px 15px rgba(0,0,0,0.08);margin-bottom:1.5rem">
        <h3 style="margin:0 0 0.5rem;color:#1e3a8a;display:flex;align-items:center;gap:0.5rem">
          <span style="background:#dbeafe;color:#2563eb;border-radius:50%;width:32px;height:32px;display:inline-flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0">1</span>
          Carregar PDF da Diretoria
        </h3>
        <p style="margin:0 0 1.5rem 2.5rem;color:#64748b;font-size:0.9rem">Selecione o PDF exportado do Power BI (modelo "Vis√£o de Tabela") para extrair dados operacionais automaticamente.</p>
        <div id="diretoriaDrop" onclick="document.getElementById('diretoriaPdfInput').click()" style="border:2.5px dashed #93c5fd;border-radius:12px;padding:2.5rem;text-align:center;cursor:pointer;background:#f8fafc;transition:all 0.3s" onmouseover="this.style.borderColor='#2563eb';this.style.background='#eff6ff'" onmouseout="this.style.borderColor='#93c5fd';this.style.background='#f8fafc'">
          <div style="font-size:3rem;margin-bottom:0.75rem">üìÑ</div>
          <p style="margin:0;font-weight:600;color:#1e3a8a">Clique para selecionar o PDF</p>
          <p style="margin:0.25rem 0 0;font-size:0.85rem;color:#94a3b8">Arquivo PDF exportado do Power BI</p>
        </div>
        <input type="file" id="diretoriaPdfInput" accept=".pdf" style="display:none" onchange="diretoriaCarregarPdf(this)">
        <div id="diretoriaLoadingOCR" style="display:none;margin-top:1.5rem;text-align:center;padding:1.5rem;background:#eff6ff;border-radius:10px">
          <div style="font-size:2rem;margin-bottom:0.5rem">‚è≥</div>
          <div id="diretoriaOCRStatus" style="font-weight:600;color:#1d4ed8">Lendo PDF...</div>
          <div style="margin-top:0.5rem;background:#dbeafe;border-radius:8px;height:8px;overflow:hidden"><div id="diretoriaOCRBar" style="background:#2563eb;height:100%;width:0%;transition:width 0.3s"></div></div>
        </div>
        <div id="diretoriaPdfInfo" style="display:none;margin-top:1rem;padding:1rem;background:#f0fdf4;border-radius:8px;border:1px solid #86efac">
          <span id="diretoriaPdfNome" style="font-weight:600;color:#166534"></span><span style="color:#166534"> ‚úì lido com sucesso</span>
        </div>
      </div>

      <!-- SE√á√ÉO 2: Dados extra√≠dos -->
      <div id="diretoriaPreviewSection" style="display:none;background:white;border-radius:16px;padding:2rem;box-shadow:0 4px 15px rgba(0,0,0,0.08);margin-bottom:1.5rem">
        <h3 style="margin:0 0 0.5rem;color:#1e3a8a;display:flex;align-items:center;gap:0.5rem">
          <span style="background:#dbeafe;color:#2563eb;border-radius:50%;width:32px;height:32px;display:inline-flex;align-items:center;justify-content:center;font-weight:700;flex-shrink:0">2</span>
          Dados Lidos ‚Äî Revise e Corrija se Necess√°rio
        </h3>
        <p style="margin:0 0 1.5rem 2.5rem;color:#64748b;font-size:0.9rem">Revise os valores extra√≠dos antes de salvar. Voc√™ pode editar qualquer campo clicando nele.</p>
        <div id="diretoriaMesAno" style="background:#eff6ff;padding:0.75rem 1rem;border-radius:8px;font-weight:700;color:#1e3a8a;margin-bottom:1.5rem;display:flex;gap:2rem;flex-wrap:wrap;align-items:center">
          <span>üìÖ M√™s: <select id="dirMes" onchange="diretoriaDadosExtraidos=null;diretoriaVerificarMesAno()" style="border:none;background:transparent;font-weight:700;color:#1e3a8a;font-size:1rem">
            <option value="0">Janeiro</option><option value="1">Fevereiro</option><option value="2">Mar√ßo</option>
            <option value="3">Abril</option><option value="4">Maio</option><option value="5">Junho</option>
            <option value="6">Julho</option><option value="7">Agosto</option><option value="8">Setembro</option>
            <option value="9">Outubro</option><option value="10">Novembro</option><option value="11">Dezembro</option>
          </select></span>
          <span>üóì Ano: <input id="dirAno" type="number" value="2026" onchange="diretoriaDadosExtraidos=null;diretoriaVerificarMesAno()" style="border:none;background:transparent;font-weight:700;color:#1e3a8a;font-size:1rem;width:70px"></span>
          <span id="dirStorageInfo" style="font-size:0.82rem;color:#64748b;font-weight:400"></span>
        </div>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:1rem" id="diretoriaDataGrid"></div>
        <div style="margin-top:2rem;padding-top:1.5rem;border-top:2px solid #e2e8f0">
          <button onclick="diretoriaCarregarInformacoes()" id="btnCarregarInfo"
            style="width:100%;padding:1.2rem;background:linear-gradient(135deg,#2563eb,#1e3a8a);color:white;border:none;border-radius:12px;font-size:1.05rem;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:0.6rem;transition:opacity 0.2s"
            onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
            üíæ Carregar Informa√ß√µes
          </button>
          <div id="dirSalvoMsg" style="display:none;margin-top:1rem;padding:0.9rem 1.25rem;border-radius:10px;text-align:center;font-weight:600;font-size:0.95rem"></div>
        </div>
      </div>

      <!-- SE√á√ÉO 3: Par√¢metros da Comiss√£o -->
      <div style="background:white;border-radius:16px;padding:2rem;box-shadow:0 4px 15px rgba(0,0,0,0.08);margin-bottom:1.5rem">
        <h3 style="margin:0 0 1.5rem;color:#1e293b;font-size:1.1rem;display:flex;align-items:center;gap:0.5rem">
          <span style="font-size:1.2rem">‚öôÔ∏è</span> Par√¢metros da Comiss√£o (edit√°veis)
        </h3>

        <!-- Cards de taxas (grid 4 colunas) -->
        <div style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:1rem;margin-bottom:2rem">

          <!-- Meta % Juros -->
          <div style="border:1px solid #e2e8f0;border-radius:12px;padding:1.25rem">
            <div style="font-size:0.82rem;color:#64748b;margin-bottom:0.75rem;font-weight:500">Meta % Juros (m√≠n.)</div>
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem">
              <input type="number" step="0.01" id="param_metaJuros" value="1.90"
                style="width:90px;padding:0.5rem 0.75rem;border:2px solid #2563eb;border-radius:8px;font-size:1.1rem;font-weight:700;text-align:center"
                onchange="salvarParams()">
              <span style="color:#64748b;font-weight:600">%</span>
            </div>
            <div style="font-size:0.75rem;color:#94a3b8">Porcentagem m√≠nima Juros/Faturamento para ganhar comiss√£o</div>
          </div>

          <!-- Taxa Comiss√£o Juros -->
          <div style="border:1px solid #e2e8f0;border-radius:12px;padding:1.25rem">
            <div style="font-size:0.82rem;color:#64748b;margin-bottom:0.75rem;font-weight:500">Taxa Comiss√£o Juros</div>
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem">
              <input type="number" step="0.01" id="param_txComissaoJuros" value="1.10"
                style="width:90px;padding:0.5rem 0.75rem;border:2px solid #2563eb;border-radius:8px;font-size:1.1rem;font-weight:700;text-align:center"
                onchange="salvarParams()">
              <span style="color:#64748b;font-weight:600">%</span>
            </div>
            <div style="font-size:0.75rem;color:#94a3b8">Taxa aplicada sobre os Juros quando meta √© atingida</div>
          </div>

          <!-- Taxa Recorr√™ncia -->
          <div style="border:1px solid #e2e8f0;border-radius:12px;padding:1.25rem">
            <div style="font-size:0.82rem;color:#64748b;margin-bottom:0.75rem;font-weight:500">Taxa Recorr√™ncia</div>
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem">
              <input type="number" step="0.01" id="param_txRecorrencia" value="14.00"
                style="width:90px;padding:0.5rem 0.75rem;border:2px solid #2563eb;border-radius:8px;font-size:1.1rem;font-weight:700;text-align:center"
                onchange="salvarParams()">
              <span style="color:#64748b;font-weight:600">%</span>
            </div>
            <div style="font-size:0.75rem;color:#94a3b8">Taxa aplicada sobre Resultado L√≠quido (Diretoria)</div>
          </div>

          <!-- Limite M√°ximo Tarifas -->
          <div style="border:1px solid #e2e8f0;border-radius:12px;padding:1.25rem">
            <div style="font-size:0.82rem;color:#64748b;margin-bottom:0.75rem;font-weight:500">Limite M√°ximo Tarifas</div>
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem">
              <input type="number" step="0.01" id="param_limTarifas" value="0.38"
                style="width:90px;padding:0.5rem 0.75rem;border:2px solid #2563eb;border-radius:8px;font-size:1.1rem;font-weight:700;text-align:center"
                onchange="salvarParams()">
              <span style="color:#64748b;font-weight:600">%</span>
            </div>
            <div style="font-size:0.75rem;color:#94a3b8">Tarifas/Faturamento deve ficar ABAIXO desse limite</div>
          </div>

          <!-- Taxa Comiss√£o Efici√™ncia -->
          <div style="border:1px solid #e2e8f0;border-radius:12px;padding:1.25rem">
            <div style="font-size:0.82rem;color:#64748b;margin-bottom:0.75rem;font-weight:500">Taxa Banc√°ria</div>
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem">
              <input type="number" step="0.001" id="param_txEficiencia" value="0.015"
                style="width:90px;padding:0.5rem 0.75rem;border:2px solid #2563eb;border-radius:8px;font-size:1.1rem;font-weight:700;text-align:center"
                onchange="salvarParams()">
              <span style="color:#64748b;font-weight:600">%</span>
            </div>
            <div style="font-size:0.75rem;color:#94a3b8">Taxa banc√°ria sobre o Faturamento</div>
          </div>

          <!-- Taxa EBITDA Mensal -->
          <div style="border:1px solid #e2e8f0;border-radius:12px;padding:1.25rem">
            <div style="font-size:0.82rem;color:#64748b;margin-bottom:0.75rem;font-weight:500">Taxa EBITDA Mensal</div>
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem">
              <input type="number" step="0.01" id="param_txEbitdaMensal" value="0.10"
                style="width:90px;padding:0.5rem 0.75rem;border:2px solid #2563eb;border-radius:8px;font-size:1.1rem;font-weight:700;text-align:center"
                onchange="salvarParams()">
              <span style="color:#64748b;font-weight:600">%</span>
            </div>
            <div style="font-size:0.75rem;color:#94a3b8">Taxa aplicada sobre EBITDA quando margem ‚â• meta mensal</div>
          </div>

          <!-- Taxa B√¥nus Trimestral -->
          <div style="border:1px solid #e2e8f0;border-radius:12px;padding:1.25rem">
            <div style="font-size:0.82rem;color:#64748b;margin-bottom:0.75rem;font-weight:500">Taxa B√¥nus Trimestral</div>
            <div style="display:flex;align-items:center;gap:0.5rem;margin-bottom:0.5rem">
              <input type="number" step="0.01" id="param_txBonusTrim" value="0.20"
                style="width:90px;padding:0.5rem 0.75rem;border:2px solid #2563eb;border-radius:8px;font-size:1.1rem;font-weight:700;text-align:center"
                onchange="salvarParams()">
              <span style="color:#64748b;font-weight:600">%</span>
            </div>
            <div style="font-size:0.75rem;color:#94a3b8">Taxa aplicada sobre EBITDA trimestral quando meta √© batida</div>
          </div>

        </div>

        <!-- Meta % EBITDA por M√™s -->
        <div style="background:#fffbeb;border:1px solid #fde68a;border-radius:12px;padding:1.5rem;margin-bottom:1.5rem">
          <h4 style="margin:0 0 1rem;color:#92400e;font-size:0.95rem;display:flex;align-items:center;gap:0.5rem">
            <span>üéØ</span> Meta % EBITDA por M√™s (edit√°vel)
          </h4>
          <div style="display:grid;grid-template-columns:repeat(6,1fr);gap:0.75rem">
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Jan</div>
              <input type="number" step="0.01" id="metaEbitda_jan" value="33.29" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Fev</div>
              <input type="number" step="0.01" id="metaEbitda_fev" value="28.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Mar</div>
              <input type="number" step="0.01" id="metaEbitda_mar" value="27.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Abr</div>
              <input type="number" step="0.01" id="metaEbitda_abr" value="0.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Mai</div>
              <input type="number" step="0.01" id="metaEbitda_mai" value="0.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Jun</div>
              <input type="number" step="0.01" id="metaEbitda_jun" value="0.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Jul</div>
              <input type="number" step="0.01" id="metaEbitda_jul" value="0.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Ago</div>
              <input type="number" step="0.01" id="metaEbitda_ago" value="0.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Set</div>
              <input type="number" step="0.01" id="metaEbitda_set" value="0.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Out</div>
              <input type="number" step="0.01" id="metaEbitda_out" value="0.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Nov</div>
              <input type="number" step="0.01" id="metaEbitda_nov" value="0.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
            <div style="text-align:center">
              <div style="font-size:0.78rem;font-weight:600;color:#475569;margin-bottom:0.4rem">Dez</div>
              <input type="number" step="0.01" id="metaEbitda_dez" value="0.00" style="width:100%;padding:0.5rem 0.25rem;border:1px solid #fde68a;border-radius:6px;text-align:center;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
              <div style="font-size:0.7rem;color:#94a3b8;margin-top:0.2rem">%</div>
            </div>
          </div>
        </div>

        <!-- Meta EBITDA Trimestral -->
        <div style="background:#fffbeb;border:1px solid #fde68a;border-radius:12px;padding:1.5rem;margin-bottom:1.5rem">
          <h4 style="margin:0 0 1rem;color:#92400e;font-size:0.95rem;display:flex;align-items:center;gap:0.5rem">
            <span>üèÜ</span> Meta EBITDA Trimestral (R$)
          </h4>
          <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:1rem">
            <div>
              <label style="display:block;font-size:0.82rem;color:#64748b;font-weight:500;margin-bottom:0.4rem">Q1 (Jan-Mar)</label>
              <input type="number" step="100" id="metaTrim_q1" value="2401769.91" style="width:100%;padding:0.6rem 0.75rem;border:1px solid #fde68a;border-radius:8px;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
            </div>
            <div>
              <label style="display:block;font-size:0.82rem;color:#64748b;font-weight:500;margin-bottom:0.4rem">Q2 (Abr-Jun)</label>
              <input type="number" step="100" id="metaTrim_q2" value="0" style="width:100%;padding:0.6rem 0.75rem;border:1px solid #fde68a;border-radius:8px;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
            </div>
            <div>
              <label style="display:block;font-size:0.82rem;color:#64748b;font-weight:500;margin-bottom:0.4rem">Q3 (Jul-Set)</label>
              <input type="number" step="100" id="metaTrim_q3" value="0" style="width:100%;padding:0.6rem 0.75rem;border:1px solid #fde68a;border-radius:8px;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
            </div>
            <div>
              <label style="display:block;font-size:0.82rem;color:#64748b;font-weight:500;margin-bottom:0.4rem">Q4 (Out-Dez)</label>
              <input type="number" step="100" id="metaTrim_q4" value="0" style="width:100%;padding:0.6rem 0.75rem;border:1px solid #fde68a;border-radius:8px;font-weight:700;font-size:0.9rem;background:white" onchange="salvarParams()">
            </div>
          </div>
        </div>

        <!-- Bot√£o salvar -->
        <div style="display:flex;justify-content:flex-end">
          <button onclick="salvarParams()" style="padding:0.75rem 2.5rem;background:linear-gradient(135deg,#2563eb,#1e3a8a);color:white;border:none;border-radius:10px;font-size:0.95rem;font-weight:700;cursor:pointer;display:flex;align-items:center;gap:0.5rem;transition:opacity 0.2s" onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
            üíæ Salvar Par√¢metros
          </button>
        </div>
        <div id="paramSalvoMsg" style="display:none;margin-top:0.75rem;text-align:right;color:#059669;font-weight:600;font-size:0.88rem">‚úì Par√¢metros salvos!</div>
      </div>

    </div>
      </div>

      <!-- COMISS√ÉO FINANCEIRO VIEW -->
      <div id="comissaoFinanceiroView" class="view-container" style="display:none">
    <div style="max-width:1400px;margin:0 auto;padding:2rem">

      <!-- Header -->
      <div style="background:linear-gradient(135deg,#1e3a8a,#7c3aed,#059669);padding:2rem 2.5rem;border-radius:20px;color:white;margin-bottom:1.5rem">
        <div style="display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem">
          <div>
            <h1 style="margin:0;font-size:2rem">üíº Comiss√£o Financeiro</h1>
            <p style="margin:0.4rem 0 0;opacity:0.85;font-size:0.95rem">Matriz de Resultado 2026 ‚Äî Calculada automaticamente com base nos par√¢metros e dados do sistema</p>
          </div>
          <div style="display:flex;align-items:center;gap:1rem;flex-wrap:wrap">
            <div style="background:rgba(255,255,255,0.15);border-radius:10px;padding:0.5rem 1rem;display:flex;align-items:center;gap:0.75rem">
              <label style="font-size:0.85rem;font-weight:600;opacity:0.9">üìÖ M√™s:</label>
              <select id="comissaoMesFiltro" onchange="renderComissao()" style="background:transparent;border:none;color:white;font-weight:700;font-size:0.95rem;cursor:pointer">
                <option value="0" style="color:#1e293b">Janeiro</option>
                <option value="1" style="color:#1e293b">Fevereiro</option>
                <option value="2" style="color:#1e293b">Mar√ßo</option>
                <option value="3" style="color:#1e293b">Abril</option>
                <option value="4" style="color:#1e293b">Maio</option>
                <option value="5" style="color:#1e293b">Junho</option>
                <option value="6" style="color:#1e293b">Julho</option>
                <option value="7" style="color:#1e293b">Agosto</option>
                <option value="8" style="color:#1e293b">Setembro</option>
                <option value="9" style="color:#1e293b">Outubro</option>
                <option value="10" style="color:#1e293b">Novembro</option>
                <option value="11" style="color:#1e293b">Dezembro</option>
              </select>
            </div>
            <div style="background:rgba(255,255,255,0.15);border-radius:10px;padding:0.5rem 1rem;display:flex;align-items:center;gap:0.75rem">
              <label style="font-size:0.85rem;font-weight:600;opacity:0.9">üóì Ano:</label>
              <select id="comissaoAnoFiltro" onchange="renderComissao()" style="background:transparent;border:none;color:white;font-weight:700;font-size:0.95rem;cursor:pointer">
                <option value="2026" style="color:#1e293b">2026</option>
                <option value="2025" style="color:#1e293b">2025</option>
              </select>
            </div>
            <button onclick="renderComissao()" style="padding:0.55rem 1.2rem;background:rgba(255,255,255,0.2);border:2px solid rgba(255,255,255,0.6);color:white;border-radius:8px;cursor:pointer;font-weight:600;font-size:0.85rem">üîÑ Atualizar</button>
          </div>
        </div>
      </div>

      <!-- Cards de Resumo (5 indicadores base) -->
      <div id="comissaoCardsResumo" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:1rem;margin-bottom:1.5rem"></div>

      <!-- Aviso fonte Diretoria -->
      <div id="comissaoAvisoDiretoria" style="display:none;background:#fef3c7;border:1px solid #fde68a;border-radius:10px;padding:0.85rem 1.25rem;margin-bottom:1.5rem;font-size:0.85rem;color:#92400e">
        ‚ö†Ô∏è <strong>Dados da Diretoria n√£o encontrados</strong> para este m√™s/ano. Recorr√™ncia e Reajuste usar√£o valor <strong>R$ 0</strong>. Para corrigir, fa√ßa o upload do PDF na aba <strong>Par√¢metros</strong>.
      </div>

      <!-- Banner m√™s fechado (oculto - status agora fica no card do Total Mensal) -->
      <div id="comissaoMesFechadoBanner" style="display:none"></div>

      <!-- MATRIZ DE INDICADORES -->
      <div style="background:white;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);padding:1.75rem;margin-bottom:1.5rem">
        <h3 style="margin:0 0 1.5rem;color:#1e293b;font-size:1.05rem;display:flex;align-items:center;gap:0.5rem">
          üìä Matriz de Indicadores
          <span id="comissaoMesLabel" style="background:#dbeafe;color:#1e40af;font-size:0.8rem;padding:0.2rem 0.6rem;border-radius:20px;font-weight:600;margin-left:0.5rem"></span>
        </h3>
        <div id="comissaoMatriz" style="display:flex;flex-direction:column;gap:1rem"></div>
      </div>

      <!-- B√îNUS TRIMESTRAL -->
      <div style="background:white;border-radius:16px;box-shadow:0 4px 20px rgba(0,0,0,0.08);padding:1.75rem;margin-bottom:1.5rem">
        <h3 style="margin:0 0 1.5rem;color:#1e293b;font-size:1.05rem">üèÜ B√¥nus Trimestral (EBITDA Acumulado)</h3>
        <div id="comissaoBonusTrim" style="display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:1rem"></div>
      </div>

      <!-- TOTAL GERAL -->
      <div id="comissaoTotalGeral" style="border-radius:16px;padding:1.75rem;margin-bottom:1.5rem"></div>

      <!-- Rodap√© fontes -->
      <div style="background:#f8fafc;border-radius:12px;padding:1rem 1.5rem;border-left:4px solid #2563eb;font-size:0.82rem;color:#475569">
        <strong style="color:#1e293b">üìå Fontes:</strong>
        <span style="background:#D1FAE5;padding:0.15rem 0.5rem;border-radius:4px;color:#065F46;font-weight:600;margin:0 0.5rem">üü¢ Consolidado</span>Faturamento, Juros, Tarifas, EBITDA
        <span style="background:#DBEAFE;padding:0.15rem 0.5rem;border-radius:4px;color:#1E40AF;font-weight:600;margin:0 0.5rem">üîµ Diretoria (PDF)</span>Resultado L√≠quido, Reajuste
        <span style="background:#FEF3C7;padding:0.15rem 0.5rem;border-radius:4px;color:#92400E;font-weight:600;margin:0 0.5rem">üü° Par√¢metros</span>Taxas e metas
      </div>

    </div>
      </div>

    </div><!-- end .content -->
  </div><!-- end .main-content -->

  <!-- Modal detalhamento (fora do main para overlay correto) -->
  <div id="dailyModal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header"><h2 class="modal-title" id="modalTitle">Detalhamento</h2><button class="modal-close" onclick="fecharModal()">√ó</button></div>
      <div class="modal-body"><div id="modalTableContent"></div></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script>
    // ==================== SUPABASE CONFIG ====================
    const SB_URL  = 'https://rgdagcvpgdlefmiywurz.supabase.co';
    const SB_KEY  = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InJnZGFnY3ZwZ2RsZWZtaXl3dXJ6Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE5Mzk3MjUsImV4cCI6MjA4NzUxNTcyNX0.IT0nPkVhOODgFYLqnAwVjdtP_2PTeBPq0Aj0yB7jpKQ';
    const sb = supabase.createClient(SB_URL, SB_KEY);

    // Log visual no canto da tela para debug
    function sbLog(msg, tipo='info') {
      const colors = { ok:'#059669', erro:'#dc2626', info:'#2563eb', warn:'#d97706' };
      const div = document.createElement('div');
      div.style.cssText = `position:fixed;bottom:${10 + document.querySelectorAll('.sb-log').length*42}px;right:10px;background:white;border-left:4px solid ${colors[tipo]};padding:6px 12px;border-radius:6px;font-size:0.75rem;box-shadow:0 2px 8px rgba(0,0,0,0.15);z-index:99999;max-width:320px;word-break:break-all`;
      div.className = 'sb-log';
      div.textContent = `[Supabase] ${msg}`;
      document.body.appendChild(div);
      setTimeout(() => { div.remove(); document.querySelectorAll('.sb-log').forEach((el,i)=>el.style.bottom=(10+i*42)+'px'); }, 6000);
    }

    // Wrapper key‚Üívalue sobre a tabela app_storage
    const sbStorage = {
      async get(key) {
        try {
          const { data, error } = await sb.from('app_storage').select('value').eq('key', key).maybeSingle();
          if (error) { sbLog(`GET "${key}" erro: ${error.message}`, 'erro'); throw error; }
          return data ? data.value : null;
        } catch(e) {
          sbLog(`GET "${key}" falhou: ${e.message}`, 'erro');
          return localStorage.getItem(key);
        }
      },
      async set(key, value) {
        try {
          const { error } = await sb.from('app_storage').upsert({ key, value, updated_at: new Date().toISOString() }, { onConflict: 'key' });
          if (error) { sbLog(`SET "${key}" erro: ${error.message}`, 'erro'); throw error; }
          sbLog(`SET "${key}" ‚úì`, 'ok');
        } catch(e) {
          sbLog(`SET "${key}" falhou: ${e.message} ‚Äî usando localStorage`, 'warn');
          localStorage.setItem(key, value);
        }
      },
      async remove(key) {
        try {
          const { error } = await sb.from('app_storage').delete().eq('key', key);
          if (error) { sbLog(`DEL "${key}" erro: ${error.message}`, 'erro'); throw error; }
        } catch(e) {
          sbLog(`DEL "${key}" falhou: ${e.message}`, 'warn');
          localStorage.removeItem(key);
        }
      },
      // Testa a conex√£o e estrutura da tabela
      async testar() {
        sbLog('Testando conex√£o...', 'info');
        try {
          const { data, error } = await sb.from('app_storage').select('key').limit(1);
          if (error) { sbLog(`Tabela n√£o acess√≠vel: ${error.message}`, 'erro'); return false; }
          sbLog('Conex√£o OK! Tabela app_storage acess√≠vel ‚úì', 'ok');
          return true;
        } catch(e) { sbLog(`Falha de conex√£o: ${e.message}`, 'erro'); return false; }
      }
    };

    // Testa automaticamente ao carregar
    window.addEventListener('load', () => sbStorage.testar());
    // =========================================================

    let consolidadoMesSelecionado = '01';
    let anoSelecionadoComparativo = 2026;
    let diretoriaDadosExtraidos = null;

    // ==================== DADOS FINANCEIROS ====================
    const dadosFinanceiros = {
      receitas: [
        { nome:"Link Pessoa F√≠sica",jan:1463928.46,fev:1235675.95,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:2699604.41 },
        { nome:"Link Pessoa Jur√≠dica",jan:1189771.05,fev:788162.94,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:1977933.99 },
        { nome:"Juros/Multa",jan:56504.43,fev:38890.31,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:95394.74 },
        { nome:"Taxa de instala√ß√£o",jan:7135.13,fev:2266.66,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:9401.79 },
        { nome:"Eventos",jan:3150.0,fev:3497.01,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:6647.01 },
        { nome:"Multa fidelidade e equipamento",jan:663.87,fev:1139.97,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:1803.84 },
        { nome:"Rendimentos financeiros",jan:2160.49,fev:2472.71,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:4633.2 },
        { nome:"V. Ativos imobilizados",jan:0.0,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:0.0 },
        { nome:"Vendas canceladas e estornos",jan:-2757.11,fev:-572.13,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:-3329.24 }
      ],
      impostos: [
        { nome:"ICMS",jan:88221.38,fev:99080.62,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:187302.0 },
        { nome:"COFINS",jan:52907.2,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:52907.2 },
        { nome:"PIS",jan:11417.3,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:11417.3 },
        { nome:"IRPJ",jan:70847.45,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:70847.45 },
        { nome:"CSLL",jan:27665.08,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:27665.08 },
        { nome:"ISS",jan:5745.14,fev:6285.8,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:12030.94 },
        { nome:"ISS Retido",jan:1218.24,fev:1267.39,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:2485.63 },
        { nome:"Simples Nacional",jan:1626.28,fev:1343.8,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:2970.08 },
        { nome:"FUST/FUNTTEL",jan:17091.99,fev:12526.67,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:29618.66 }
      ],
      custos: [
        { nome:"Kit Instala√ß√£o",jan:152053.14,fev:174266.31,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:326319.45 },
        { nome:"Materiais de Rede",jan:49341.66,fev:22670.74,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:72012.4 },
        { nome:"Links de Dados / Voip",jan:57341.58,fev:56833.25,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:114174.83 },
        { nome:"Vtal",jan:62847.53,fev:64036.63,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:126884.16 },
        { nome:"Alugueis de Postes",jan:17793.58,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:17793.58 },
        { nome:"Alugueis de Torre e POP",jan:14480.49,fev:10440.56,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:24921.05 },
        { nome:"Custo com SVA",jan:13393.41,fev:13393.41,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:26786.82 },
        { nome:"Energia / POP",jan:29532.99,fev:11047.02,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:40580.01 },
        { nome:"Manuten√ß√£o POP",jan:2795.5,fev:691.69,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:3487.19 },
        { nome:"Comiss√µes de vendas",jan:38831.33,fev:29272.77,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:68104.1 },
        { nome:"Combustivel t√©cnico",jan:31157.92,fev:32876.03,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:64033.95 },
        { nome:"Manut. Ve√≠culo",jan:17987.66,fev:14486.91,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:32474.57 },
        { nome:"Folha - Direta",jan:709835.26,fev:561211.24,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:1271046.5 },
        { nome:"Telefonia",jan:4632.76,fev:4393.22,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:9025.98 },
        { nome:"Man. Equipamento",jan:779.28,fev:140.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:919.28 },
        { nome:"Ferramentas",jan:8224.74,fev:6483.02,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:14707.76 },
        { nome:"Moveis e equipamentos escrit√≥rio TI",jan:1241.88,fev:1233.53,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:2475.41 },
        { nome:"Terceriza√ß√£o de Serv. (Instala√ß√µes)",jan:0.0,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:0.0 },
        { nome:"Custos Lastmile",jan:34330.68,fev:33940.41,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:68271.09 }
      ],
      despesas: [
        { nome:"Marketing",jan:54183.69,fev:51344.74,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:105528.43 },
        { nome:"Serv. Terceiros, jur√≠dicos e consultorias",jan:39654.73,fev:29887.23,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:69541.96 },
        { nome:"Viagens/Estadia",jan:0.0,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:0.0 },
        { nome:"Seguran√ßa Trabalho/ EPI",jan:332.5,fev:2041.42,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:2373.92 },
        { nome:"Desp. Aluguel de escrit√≥rio",jan:25978.9,fev:26994.1,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:52973.0 },
        { nome:"Desp. Reformas empresa",jan:3552.5,fev:2193.71,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:5746.21 },
        { nome:"Material de uso, consumo e papelaria",jan:2463.51,fev:327.8,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:2791.31 },
        { nome:"Combustivel Adm",jan:954.05,fev:801.72,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:1755.77 },
        { nome:"Despesas e taxas com Veiculos",jan:955.76,fev:13047.56,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:14003.32 },
        { nome:"Despesas Tribut√°rias/ Taxas legais",jan:3609.38,fev:571.43,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:4180.81 },
        { nome:"Despesas Judiciais",jan:606.02,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:606.02 },
        { nome:"Treinamentos",jan:0.0,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:0.0 },
        { nome:"Pr√≥-Labore",jan:200000.0,fev:200000.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:400000.0 },
        { nome:"Sistema",jan:18131.16,fev:21847.41,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:39978.57 },
        { nome:"Taxas Boleto",jan:9409.45,fev:6727.14,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:16136.59 },
        { nome:"En√©rgia El√©trica escrit√≥rio",jan:2307.66,fev:4977.36,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:7285.02 },
        { nome:"Despesas Diversas / Estacionamento",jan:1412.13,fev:3715.51,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:5127.64 },
        { nome:"Tarifas banc√°rias",jan:1402.08,fev:30.82,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:1432.9 }
      ],
      ebitda: [
        { nome:"EBITDA",jan:832261.35,fev:549104.45,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:1381365.8 }
      ],
      ebitda_ajustado: [
        { nome:"IRPJ (Previs√£o)",jan:20713.14,fev:0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:20713.14 },
        { nome:"CSSL (Previs√£o)",jan:8176.73,fev:0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:8176.73 },
        { nome:"Trimestral",jan:98512.53,fev:0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:98512.53 },
        { nome:"Compra de Provedor",jan:11708.33,fev:11708.33,mar:11708.33,abr:11708.33,mai:11708.33,jun:11708.33,jul:11708.33,ago:11708.33,set:11708.33,out:11708.33,nov:11708.33,dez:11708.33,total:140499.96 },
        { nome:"Ajuste (Postes)",jan:30497.32,fev:0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:30497.32 },
        { nome:"Ajuste Vtal Fora",jan:14996.53,fev:0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:14996.53 },
        { nome:"EBITDA (Ajustado)",jan:844681.83,fev:520862.30,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:1365544.13 }
      ],
      ajustes: [
        { nome:"Investimento",jan:26980.22,fev:59809.14,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:86789.36 },
        { nome:"Empr/Finac/Parcel",jan:417745.56,fev:396693.89,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:814439.45 },
        { nome:"Impostos",jan:44979.14,fev:0.0,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:44979.14 },
        { nome:"S√≥cios ou Retiradas",jan:293512.31,fev:299669.73,mar:0,abr:0,mai:0,jun:0,jul:0,ago:0,set:0,out:0,nov:0,dez:0,total:593182.04 }
      ],
      bancos: [
        { nome:"MG - Ita√∫",jan:0,fev:0,total:0 },
        { nome:"Speed - Ita√∫ + Vinc.",jan:0,fev:0,total:0 },
        { nome:"Caixa Tesouraria",jan:0,fev:0,total:0 }
      ]
    };

    const dadosComparativos = {
      2026:{receitas:2851389.90,custos:1700000,despesas:700000,ebitda:938703.66,ebitdaAjustado:852829.83},
      2025:{receitas:2500000,custos:1500000,despesas:600000,ebitda:850000,ebitdaAjustado:750000},
      2024:{receitas:2200000,custos:1400000,despesas:550000,ebitda:750000,ebitdaAjustado:650000}
    };

    function formatCurrency(v) {
      if (v===null||v===undefined) return '-';
      return new Intl.NumberFormat('pt-BR',{style:'currency',currency:'BRL',minimumFractionDigits:2}).format(v);
    }

    function selectMenu(el,view) {
      document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
      el.classList.add('active');
      document.getElementById('viewType').value = view;
      changeView();
    }

    function changeView() {
      const v = document.getElementById('viewType').value;
      document.querySelectorAll('.view-container').forEach(c=>{c.classList.remove('active');c.style.display='none';});
      const hideHeader = ['consolidado','comparativo','powerbi','ia-estrategica','diretoria','comissao-financeiro'];
      document.getElementById('mainHeader').style.display = hideHeader.includes(v) ? 'none' : 'block';
      const show = id => { const el=document.getElementById(id); el.style.display='block'; el.classList.add('active'); };
      if (v==='dashboard') { show('dashboardView'); renderizarGraficos(); }
      else if (v==='consolidado') { show('consolidadoView'); showTab('receitas'); }
      else if (v==='comparativo') { show('comparativoView'); renderComparisonCards(); renderCompTab('receitas-comp'); }
      else if (v==='powerbi') show('powerbiView');
      else if (v==='ia-estrategica') { show('iaEstrategicaView'); carregarApiKey(); }
      else if (v==='diretoria') { show('diretoriaView'); carregarParams(); diretoriaCarregarUltimoMes(); }
      else if (v==='comissao-financeiro') { show('comissaoFinanceiroView'); carregarParams().then(()=>renderComissao()); }
    }

    function updatePeriod() {}
    function applyFilters() { alert('Filtros aplicados!\nPer√≠odo: '+document.getElementById('periodFilter').value); }
    function fecharModal() { document.getElementById('dailyModal').classList.remove('active'); }
    function salvarApiKey() {
      const v = document.getElementById('openaiApiKey').value;
      sbStorage.set('openaiKey', v);
      alert('Salvo!');
    }
    async function carregarApiKey() {
      const k = await sbStorage.get('openaiKey');
      if (k) document.getElementById('openaiApiKey').value = k;
    }

    function onConsolidadoPeriodoChange() {
      const [ano,mes] = document.getElementById('consolidadoPeriodo').value.split('-');
      consolidadoMesSelecionado = mes;
      consolidadoAnoSelecionado = ano;
      document.querySelector('#consolidadoView h2').innerText = 'Fluxo de Caixa - '+ano;
      showTab('receitas');
    }

    const MONTHS = ['jan','fev','mar','abr','mai','jun','jul','ago','set','out','nov','dez'];
    const MTHS_L = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];

    // Dados di√°rios extra√≠dos da planilha
    const dadosDiarios = {
      'JAN/26': {
      "receitas": [{"nome":"Link Pessoa F√≠sica","valores":{"dia_1":18490.49,"dia_2":73584.34,"dia_3":24444.98,"dia_4":19226.01,"dia_5":153731.9,"dia_6":79364.24,"dia_7":74939.99,"dia_8":61382.16,"dia_9":72314.52,"dia_10":36164.5,"dia_11":12990.18,"dia_12":100216.1,"dia_13":57733.98,"dia_14":42441.74,"dia_15":74528.01,"dia_16":49717.59,"dia_17":16632.81,"dia_18":10813.16,"dia_19":52250.31,"dia_20":81383.88,"dia_21":43048.5,"dia_22":31823.28,"dia_23":24541.81,"dia_24":14676.12,"dia_25":13372.35,"dia_26":59350.48,"dia_27":38567.01,"dia_28":24774.73,"dia_29":24982.53,"dia_30":49145.23,"dia_31":27295.53},"total":1463928.46},
            {"nome":"Link Pessoa Jur√≠dica","valores":{"dia_1":0.0,"dia_2":2413.88,"dia_3":362.32,"dia_4":179.53,"dia_5":29855.8,"dia_6":102006.14,"dia_7":10098.24,"dia_8":10304.25,"dia_9":25551.65,"dia_10":2030.52,"dia_11":640.94,"dia_12":46627.59,"dia_13":162710.64,"dia_14":21072.7,"dia_15":31460.63,"dia_16":109222.44,"dia_17":109.9,"dia_18":183.56,"dia_19":14894.89,"dia_20":56018.0,"dia_21":134195.5,"dia_22":24515.87,"dia_23":14575.8,"dia_24":230.8,"dia_25":731.3,"dia_26":74637.71,"dia_27":253333.63,"dia_28":37875.55,"dia_29":14886.28,"dia_30":8957.97,"dia_31":87.02},"total":1189771.05},
            {"nome":"Juros/Multa","valores":{"dia_1":422.29,"dia_2":1533.56,"dia_3":626.95,"dia_4":515.07,"dia_5":4963.59,"dia_6":3873.97,"dia_7":2843.68,"dia_8":1928.78,"dia_9":3318.48,"dia_10":987.61,"dia_11":290.11,"dia_12":2266.62,"dia_13":1898.71,"dia_14":2452.3,"dia_15":1852.27,"dia_16":2036.48,"dia_17":608.01,"dia_18":366.69,"dia_19":2728.17,"dia_20":2411.1,"dia_21":1746.8,"dia_22":1974.16,"dia_23":1366.32,"dia_24":473.62,"dia_25":378.63,"dia_26":3509.36,"dia_27":2152.75,"dia_28":1720.61,"dia_29":1382.02,"dia_30":2730.01,"dia_31":1145.71},"total":56504.43},
            {"nome":"Taxa de instala√ß√£o","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":200.0,"dia_6":590.0,"dia_7":100.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":200.0,"dia_16":200.0,"dia_17":0.0,"dia_18":0.0,"dia_19":400.0,"dia_20":400.0,"dia_21":2600.0,"dia_22":350.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":150.0,"dia_27":1725.34,"dia_28":0.0,"dia_29":219.79,"dia_30":0.0,"dia_31":0.0},"total":7135.13},
            {"nome":"Eventos","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":650.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":2500.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":3150.0},
            {"nome":"Multa fidelidade e equipamento","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":242.73,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":25.47,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":251.79,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":143.88,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":663.87},
            {"nome":"Rendimentos financeiros","valores":{"dia_1":0.0,"dia_2":118.32,"dia_3":0.0,"dia_4":0.0,"dia_5":139.38,"dia_6":47.9,"dia_7":218.24,"dia_8":17.84,"dia_9":19.43,"dia_10":0.0,"dia_11":0.0,"dia_12":22.5,"dia_13":15.39,"dia_14":17.56,"dia_15":46.2,"dia_16":138.02,"dia_17":0.0,"dia_18":0.0,"dia_19":174.02,"dia_20":239.73,"dia_21":79.29,"dia_22":53.42,"dia_23":77.82,"dia_24":0.0,"dia_25":0.0,"dia_26":136.08,"dia_27":106.91,"dia_28":140.23,"dia_29":139.99,"dia_30":212.22,"dia_31":0.0},"total":2160.49},
            {"nome":"V. Ativos imobilizados","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Vendas canceladas e estornos","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":-290.1,"dia_6":-48.75,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":-103.04,"dia_14":0.0,"dia_15":-69.9,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":-2101.67,"dia_20":0.0,"dia_21":-43.75,"dia_22":-99.9,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":-2757.11}
      ],
      "impostos": [{"nome":"ICMS","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":88221.38,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":88221.38},
            {"nome":"COFINS","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":52907.2,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":52907.2},
            {"nome":"PIS","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":11417.3,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":11417.3},
            {"nome":"IRPJ","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":70847.45,"dia_31":0.0},"total":70847.45},
            {"nome":"CSLL","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":27665.08,"dia_31":0.0},"total":27665.08},
            {"nome":"ISS","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":5745.14,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":5745.14},
            {"nome":"ISS Retido","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":1218.24,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":1218.24},
            {"nome":"Simples Nacional","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":1626.28,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":1626.28},
            {"nome":"FUST/FUNTTEL","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":11394.66,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":5697.33,"dia_30":0.0,"dia_31":0.0},"total":17091.99}
      ],
      "custos": [{"nome":"Kit Instala√ß√£o","valores":{"dia_1":0.0,"dia_2":2142.43,"dia_3":0.0,"dia_4":0.0,"dia_5":4578.39,"dia_6":1197.14,"dia_7":0.0,"dia_8":3919.17,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":6892.34,"dia_13":299.81,"dia_14":0.0,"dia_15":3199.33,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":10947.25,"dia_20":243.41,"dia_21":417.25,"dia_22":834.5,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":639.33,"dia_27":29774.87,"dia_28":15945.62,"dia_29":0.0,"dia_30":71022.3,"dia_31":0.0},"total":152053.14},
            {"nome":"Materiais de Rede","valores":{"dia_1":0.0,"dia_2":785.0,"dia_3":0.0,"dia_4":0.0,"dia_5":730.0,"dia_6":0.0,"dia_7":0.0,"dia_8":3432.28,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":1246.25,"dia_13":450.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":124.4,"dia_20":0.0,"dia_21":380.0,"dia_22":0.0,"dia_23":31340.93,"dia_24":0.0,"dia_25":0.0,"dia_26":472.5,"dia_27":7592.55,"dia_28":0.0,"dia_29":2787.75,"dia_30":0.0,"dia_31":0.0},"total":49341.66},
            {"nome":"Links de Dados / Voip","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":848.86,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":471.04,"dia_14":0.0,"dia_15":5430.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":5218.84,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":24285.15,"dia_24":0.0,"dia_25":0.0,"dia_26":19682.02,"dia_27":0.0,"dia_28":0.0,"dia_29":1405.67,"dia_30":0.0,"dia_31":0.0},"total":57341.58},
            {"nome":"Vtal","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":62847.53,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":62847.53},
            {"nome":"Alugueis de Postes","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":17793.58,"dia_31":0.0},"total":17793.58},
            {"nome":"Alugueis de Torre e POP","valores":{"dia_1":0.0,"dia_2":4603.75,"dia_3":0.0,"dia_4":0.0,"dia_5":2987.87,"dia_6":0.0,"dia_7":1200.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":700.0,"dia_13":350.0,"dia_14":0.0,"dia_15":100.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":1570.0,"dia_21":1800.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":500.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":668.87,"dia_31":0.0},"total":14480.49},
            {"nome":"Custo com SVA","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":13393.41,"dia_31":0.0},"total":13393.41},
            {"nome":"Energia / POP","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":221.53,"dia_13":5770.78,"dia_14":0.0,"dia_15":6870.64,"dia_16":39.83,"dia_17":0.0,"dia_18":0.0,"dia_19":238.35,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":15584.75,"dia_27":807.11,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":29532.99},
            {"nome":"Manuten√ß√£o POP","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":400.0,"dia_9":1075.5,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":570.0,"dia_17":0.0,"dia_18":0.0,"dia_19":750.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":2795.5},
            {"nome":"Comiss√µes de vendas","valores":{"dia_1":0.0,"dia_2":4902.08,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":3589.8,"dia_7":0.0,"dia_8":0.0,"dia_9":15583.16,"dia_10":0.0,"dia_11":0.0,"dia_12":299.8,"dia_13":1087.59,"dia_14":159.9,"dia_15":539.4,"dia_16":3249.5,"dia_17":0.0,"dia_18":0.0,"dia_19":59.9,"dia_20":120.0,"dia_21":0.0,"dia_22":0.0,"dia_23":9112.4,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":127.8,"dia_31":0.0},"total":38831.33},
            {"nome":"Combustivel t√©cnico","valores":{"dia_1":0.0,"dia_2":17331.74,"dia_3":0.0,"dia_4":0.0,"dia_5":100.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":13606.18,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":120.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":31157.92},
            {"nome":"Manut. Ve√≠culo","valores":{"dia_1":0.0,"dia_2":3284.42,"dia_3":0.0,"dia_4":0.0,"dia_5":750.79,"dia_6":602.46,"dia_7":694.76,"dia_8":0.0,"dia_9":645.3,"dia_10":0.0,"dia_11":0.0,"dia_12":419.27,"dia_13":152.0,"dia_14":0.0,"dia_15":329.6,"dia_16":3259.5,"dia_17":0.0,"dia_18":0.0,"dia_19":1142.28,"dia_20":200.0,"dia_21":519.33,"dia_22":0.0,"dia_23":886.8,"dia_24":0.0,"dia_25":0.0,"dia_26":1507.3,"dia_27":60.0,"dia_28":2413.5,"dia_29":639.0,"dia_30":481.35,"dia_31":0.0},"total":17987.66},
            {"nome":"Folha - Direta","valores":{"dia_1":0.0,"dia_2":19596.16,"dia_3":0.0,"dia_4":0.0,"dia_5":5365.6,"dia_6":7312.26,"dia_7":295149.54,"dia_8":2937.81,"dia_9":6323.94,"dia_10":0.0,"dia_11":0.0,"dia_12":5737.52,"dia_13":1389.6,"dia_14":7852.73,"dia_15":2170.16,"dia_16":2197.98,"dia_17":0.0,"dia_18":0.0,"dia_19":60617.87,"dia_20":185577.62,"dia_21":50.0,"dia_22":2500.0,"dia_23":250.0,"dia_24":0.0,"dia_25":0.0,"dia_26":33150.57,"dia_27":1007.66,"dia_28":2652.05,"dia_29":66466.59,"dia_30":1529.6,"dia_31":0.0},"total":709835.26},
            {"nome":"Telefonia","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":3620.08,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":827.51,"dia_17":0.0,"dia_18":0.0,"dia_19":185.17,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":4632.76},
            {"nome":"Man. Equipamento","valores":{"dia_1":0.0,"dia_2":379.28,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":100.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":300.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":779.28},
            {"nome":"Ferramentas","valores":{"dia_1":0.0,"dia_2":5900.08,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":1982.16,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":302.5,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":40.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":8224.74},
            {"nome":"Moveis e equipamentos escrit√≥rio TI","valores":{"dia_1":0.0,"dia_2":-353.21,"dia_3":0.0,"dia_4":0.0,"dia_5":617.5,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":77.57,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":900.02,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":1241.88},
            {"nome":"Terceriza√ß√£o de Serv. (Instala√ß√µes)","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Custos Lastmile","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":400.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":2377.42,"dia_13":1163.04,"dia_14":0.0,"dia_15":4070.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":4654.56,"dia_20":8550.54,"dia_21":0.0,"dia_22":0.0,"dia_23":2184.8,"dia_24":0.0,"dia_25":0.0,"dia_26":6820.52,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":4109.8,"dia_31":0.0},"total":34330.68}
      ],
      "despesas_operacionais": [{"nome":"Marketing","valores":{"dia_1":0.0,"dia_2":4021.95,"dia_3":0.0,"dia_4":0.0,"dia_5":20109.4,"dia_6":4306.28,"dia_7":0.0,"dia_8":1065.0,"dia_9":4899.0,"dia_10":0.0,"dia_11":0.0,"dia_12":6770.98,"dia_13":875.0,"dia_14":777.19,"dia_15":1799.0,"dia_16":1420.0,"dia_17":0.0,"dia_18":0.0,"dia_19":177.45,"dia_20":112.44,"dia_21":0.0,"dia_22":450.0,"dia_23":4200.0,"dia_24":0.0,"dia_25":0.0,"dia_26":1600.0,"dia_27":600.0,"dia_28":0.0,"dia_29":0.0,"dia_30":1000.0,"dia_31":0.0},"total":54183.69},
            {"nome":"Serv. Terceiros, jur√≠dicos e consultorias","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":2449.75,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":645.0,"dia_10":0.0,"dia_11":0.0,"dia_12":11120.05,"dia_13":7000.0,"dia_14":426.2,"dia_15":5490.0,"dia_16":200.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":786.23,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":11000.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":537.5,"dia_31":0.0},"total":39654.73},
            {"nome":"Viagens/Estadia","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Seguran√ßa Trabalho/ EPI","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":332.5,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":332.5},
            {"nome":"Desp. Aluguel de escrit√≥rio","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":582.75,"dia_6":0.0,"dia_7":0.0,"dia_8":24741.15,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":65.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":590.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":25978.9},
            {"nome":"Desp. Reformas empresa","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":446.72,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":70.0,"dia_15":2155.78,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":880.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":3552.5},
            {"nome":"Material de uso, consumo e papelaria","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":405.0,"dia_14":0.0,"dia_15":1346.06,"dia_16":404.05,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":308.4,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":2463.51},
            {"nome":"Combustivel Adm","valores":{"dia_1":0.0,"dia_2":486.96,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":467.09,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":954.05},
            {"nome":"Despesas e taxas com Veiculos","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":741.61,"dia_20":214.15,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":955.76},
            {"nome":"Despesas Tribut√°rias/ Taxas legais","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":479.7,"dia_20":0.0,"dia_21":0.0,"dia_22":108.39,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":2750.0,"dia_28":271.29,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":3609.38},
            {"nome":"Despesas Judiciais","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":606.02,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":606.02},
            {"nome":"Treinamentos","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Pr√≥-Labore","valores":{"dia_1":0.0,"dia_2":2809.14,"dia_3":0.0,"dia_4":0.0,"dia_5":81152.21,"dia_6":66885.0,"dia_7":18923.84,"dia_8":3372.61,"dia_9":26857.2,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":200000.0},
            {"nome":"Sistema","valores":{"dia_1":0.0,"dia_2":39.9,"dia_3":0.0,"dia_4":0.0,"dia_5":189.9,"dia_6":3316.26,"dia_7":1086.01,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":5007.57,"dia_13":978.0,"dia_14":0.0,"dia_15":746.6,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":6766.92,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":18131.16},
            {"nome":"Taxas Boleto","valores":{"dia_1":8.88,"dia_2":45.24,"dia_3":17.76,"dia_4":15.12,"dia_5":347.37,"dia_6":763.04,"dia_7":1859.72,"dia_8":180.25,"dia_9":173.73,"dia_10":19.68,"dia_11":5.76,"dia_12":265.34,"dia_13":698.19,"dia_14":149.01,"dia_15":184.38,"dia_16":513.45,"dia_17":14.64,"dia_18":7.92,"dia_19":122.15,"dia_20":314.58,"dia_21":566.16,"dia_22":123.44,"dia_23":87.37,"dia_24":12.0,"dia_25":13.68,"dia_26":123.29,"dia_27":621.4,"dia_28":91.71,"dia_29":56.49,"dia_30":110.55,"dia_31":1897.15},"total":9409.45},
            {"nome":"En√©rgia El√©trica escrit√≥rio","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":2307.66,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":2307.66},
            {"nome":"Despesas Diversas / Estacionamento","valores":{"dia_1":0.0,"dia_2":170.75,"dia_3":0.0,"dia_4":0.0,"dia_5":54.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":167.34,"dia_13":31.0,"dia_14":18.0,"dia_15":0.0,"dia_16":19.99,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":10.0,"dia_23":821.05,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":120.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":1412.13},
            {"nome":"Tarifas banc√°rias","valores":{"dia_1":0.0,"dia_2":183.85,"dia_3":0.0,"dia_4":0.0,"dia_5":444.62,"dia_6":378.68,"dia_7":17.57,"dia_8":13.47,"dia_9":5.44,"dia_10":0.0,"dia_11":0.0,"dia_12":13.57,"dia_13":122.14,"dia_14":13.35,"dia_15":6.85,"dia_16":17.47,"dia_17":0.0,"dia_18":0.0,"dia_19":6.74,"dia_20":5.44,"dia_21":10.63,"dia_22":2.72,"dia_23":18.88,"dia_24":0.0,"dia_25":0.0,"dia_26":17.01,"dia_27":12.39,"dia_28":5.54,"dia_29":105.72,"dia_30":0.0,"dia_31":0.0},"total":1402.08}
      ],
      "despesas_financeiras": [{"nome":"EBITDA","valores":{"dia_1":18903.9,"dia_2":11320.58,"dia_3":25416.49,"dia_4":19905.49,"dia_5":67293.7,"dia_6":97725.31,"dia_7":-230731.29,"dia_8":33571.29,"dia_9":44146.95,"dia_10":39162.95,"dia_11":13915.47,"dia_12":21065.0,"dia_13":200605.46,"dia_14":56517.92,"dia_15":57198.48,"dia_16":148595.25,"dia_17":17336.08,"dia_18":11355.49,"dia_19":-17171.26,"dia_20":-153933.85,"dia_21":177002.97,"dia_22":54587.78,"dia_23":-96950.13,"dia_24":15368.54,"dia_25":14468.6,"dia_26":47696.32,"dia_27":251771.26,"dia_28":43275.29,"dia_29":-35547.94,"dia_30":-148241.86,"dia_31":26631.11},"total":832261.35}],
      "ajustes_caixa": [{"nome":"Investimento","valores":{"dia_1":0.0,"dia_2":1900.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":5443.58,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":1265.56,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":1671.08,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":16700.0,"dia_31":0.0},"total":26980.22},
            {"nome":"Empr/Finac/Parcel","valores":{"dia_1":0.0,"dia_2":9191.86,"dia_3":0.0,"dia_4":0.0,"dia_5":587.24,"dia_6":5400.0,"dia_7":0.0,"dia_8":0.0,"dia_9":30167.92,"dia_10":0.0,"dia_11":0.0,"dia_12":25904.73,"dia_13":9635.28,"dia_14":4923.16,"dia_15":68870.76,"dia_16":4189.94,"dia_17":0.0,"dia_18":0.0,"dia_19":5802.98,"dia_20":12199.33,"dia_21":3946.79,"dia_22":72257.12,"dia_23":14922.5,"dia_24":0.0,"dia_25":0.0,"dia_26":72839.1,"dia_27":4166.25,"dia_28":13397.48,"dia_29":2053.33,"dia_30":57289.79,"dia_31":0.0},"total":417745.56},
            {"nome":"Impostos","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":44979.14,"dia_31":0.0},"total":44979.14},
            {"nome":"S√≥cios ou Retiradas","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":8116.8,"dia_10":0.0,"dia_11":0.0,"dia_12":24333.54,"dia_13":9635.28,"dia_14":279.08,"dia_15":54020.61,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":12199.33,"dia_21":2081.79,"dia_22":72257.12,"dia_23":14013.02,"dia_24":0.0,"dia_25":0.0,"dia_26":69701.36,"dia_27":4166.25,"dia_28":13397.48,"dia_29":0.0,"dia_30":9310.65,"dia_31":0.0},"total":293512.31}
      ]
      },
      'FEV/26': {
      "receitas": [{"nome":"Link Pessoa F√≠sica","valores":{"dia_1":18184.37,"dia_2":96736.12,"dia_3":82457.85,"dia_4":67146.92,"dia_5":96160.62,"dia_6":75821.63,"dia_7":25361.08,"dia_8":18778.52,"dia_9":93497.82,"dia_10":114221.41,"dia_11":59115.93,"dia_12":42174.05,"dia_13":45532.27,"dia_14":17145.79,"dia_15":17148.85,"dia_16":638.71,"dia_17":13461.79,"dia_18":76241.95,"dia_19":62132.97,"dia_20":80628.21,"dia_21":21493.56,"dia_22":12338.72,"dia_23":66015.11,"dia_24":33241.7,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":1235675.95},
            {"nome":"Link Pessoa Jur√≠dica","valores":{"dia_1":0.0,"dia_2":15859.74,"dia_3":21422.69,"dia_4":19260.08,"dia_5":24208.54,"dia_6":78594.82,"dia_7":229.1,"dia_8":131.06,"dia_9":16314.01,"dia_10":56170.39,"dia_11":146880.99,"dia_12":48995.64,"dia_13":25480.83,"dia_14":345.0,"dia_15":278.04,"dia_16":17349.48,"dia_17":139.6,"dia_18":27736.72,"dia_19":95607.43,"dia_20":51082.51,"dia_21":167.9,"dia_22":0.0,"dia_23":141908.37,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":788162.94},
            {"nome":"Juros/Multa","valores":{"dia_1":453.97,"dia_2":2642.06,"dia_3":1983.14,"dia_4":2676.09,"dia_5":1725.26,"dia_6":1965.21,"dia_7":969.43,"dia_8":485.14,"dia_9":3601.36,"dia_10":2234.93,"dia_11":1991.99,"dia_12":1946.24,"dia_13":1903.88,"dia_14":728.54,"dia_15":426.47,"dia_16":511.67,"dia_17":494.8,"dia_18":2268.62,"dia_19":3640.92,"dia_20":3426.87,"dia_21":1085.53,"dia_22":636.99,"dia_23":1091.2,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":38890.31},
            {"nome":"Taxa de instala√ß√£o","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":200.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":1200.0,"dia_10":200.0,"dia_11":66.66,"dia_12":0.0,"dia_13":600.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":2266.66},
            {"nome":"Eventos","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":2500.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":997.01,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":3497.01},
            {"nome":"Multa fidelidade e equipamento","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":202.47,"dia_4":0.0,"dia_5":0.0,"dia_6":194.85,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":332.01,"dia_11":230.79,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":179.85,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":1139.97},
            {"nome":"Rendimentos financeiros","valores":{"dia_1":0.0,"dia_2":212.6,"dia_3":165.93,"dia_4":155.86,"dia_5":175.36,"dia_6":186.88,"dia_7":0.0,"dia_8":0.0,"dia_9":148.71,"dia_10":87.82,"dia_11":102.99,"dia_12":123.08,"dia_13":115.86,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.01,"dia_19":525.67,"dia_20":248.29,"dia_21":0.0,"dia_22":0.0,"dia_23":119.81,"dia_24":103.84,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":2472.71},
            {"nome":"V. Ativos imobilizados","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Vendas canceladas e estornos","valores":{"dia_1":0.0,"dia_2":-67.47,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":-118.6,"dia_10":0.0,"dia_11":-187.19,"dia_12":-105.98,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":-92.89,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":-572.13}
      ],
      "impostos": [{"nome":"ICMS","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":99080.62,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":99080.62},
            {"nome":"COFINS","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"PIS","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"IRPJ","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"CSLL","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"ISS","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":6285.8,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":6285.8},
            {"nome":"ISS Retido","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":1267.39,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":1267.39},
            {"nome":"Simples Nacional","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":1343.8,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":1343.8},
            {"nome":"FUST/FUNTTEL","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":12526.67,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":12526.67}
      ],
      "custos": [{"nome":"Kit Instala√ß√£o","valores":{"dia_1":0.0,"dia_2":2737.22,"dia_3":35991.69,"dia_4":2139.9,"dia_5":93348.64,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":2936.25,"dia_10":2196.4,"dia_11":299.81,"dia_12":3367.5,"dia_13":12681.12,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":15355.2,"dia_20":1127.25,"dia_21":0.0,"dia_22":0.0,"dia_23":2085.33,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":174266.31},
            {"nome":"Materiais de Rede","valores":{"dia_1":0.0,"dia_2":4533.83,"dia_3":0.0,"dia_4":399.5,"dia_5":3431.46,"dia_6":100.0,"dia_7":0.0,"dia_8":0.0,"dia_9":430.0,"dia_10":816.25,"dia_11":0.0,"dia_12":0.0,"dia_13":8367.5,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":4592.2,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":22670.74},
            {"nome":"Links de Dados / Voip","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":12973.53,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":471.04,"dia_12":0.0,"dia_13":18753.53,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":24635.15,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":56833.25},
            {"nome":"Vtal","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":64036.63,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":64036.63},
            {"nome":"Alugueis de Postes","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Alugueis de Torre e POP","valores":{"dia_1":0.0,"dia_2":2608.34,"dia_3":0.0,"dia_4":0.0,"dia_5":2981.88,"dia_6":930.34,"dia_7":0.0,"dia_8":0.0,"dia_9":1200.0,"dia_10":700.0,"dia_11":0.0,"dia_12":0.0,"dia_13":450.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":1570.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":10440.56},
            {"nome":"Custo com SVA","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":13393.41,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":13393.41},
            {"nome":"Energia / POP","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":1761.17,"dia_10":2524.57,"dia_11":860.62,"dia_12":746.72,"dia_13":5153.94,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":11047.02},
            {"nome":"Manuten√ß√£o POP","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":352.69,"dia_10":0.0,"dia_11":339.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":691.69},
            {"nome":"Comiss√µes de vendas","valores":{"dia_1":0.0,"dia_2":259.7,"dia_3":0.0,"dia_4":6648.57,"dia_5":1939.2,"dia_6":329.6,"dia_7":0.0,"dia_8":0.0,"dia_9":17012.48,"dia_10":0.0,"dia_11":0.0,"dia_12":1652.55,"dia_13":1011.77,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":418.9,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":29272.77},
            {"nome":"Combustivel t√©cnico","valores":{"dia_1":0.0,"dia_2":15837.8,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":17038.23,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":32876.03},
            {"nome":"Manut. Ve√≠culo","valores":{"dia_1":0.0,"dia_2":2943.33,"dia_3":180.0,"dia_4":0.0,"dia_5":756.49,"dia_6":3035.0,"dia_7":0.0,"dia_8":0.0,"dia_9":2090.02,"dia_10":0.0,"dia_11":0.0,"dia_12":1150.47,"dia_13":3282.28,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":419.32,"dia_20":630.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":14486.91},
            {"nome":"Folha - Direta","valores":{"dia_1":0.0,"dia_2":410.04,"dia_3":3182.67,"dia_4":1288.0,"dia_5":5100.0,"dia_6":313107.63,"dia_7":0.0,"dia_8":0.0,"dia_9":6381.86,"dia_10":3374.4,"dia_11":1169.66,"dia_12":2413.57,"dia_13":4931.23,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":64202.31,"dia_20":155197.87,"dia_21":0.0,"dia_22":0.0,"dia_23":452.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":561211.24},
            {"nome":"Telefonia","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":3506.71,"dia_11":59.0,"dia_12":119.99,"dia_13":707.52,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":4393.22},
            {"nome":"Man. Equipamento","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":140.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":140.0},
            {"nome":"Ferramentas","valores":{"dia_1":0.0,"dia_2":3008.85,"dia_3":660.0,"dia_4":656.25,"dia_5":110.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":789.38,"dia_10":740.0,"dia_11":0.0,"dia_12":0.0,"dia_13":302.5,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":20.8,"dia_20":195.24,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":6483.02},
            {"nome":"Moveis e equipamentos escrit√≥rio TI","valores":{"dia_1":0.0,"dia_2":813.99,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":419.54,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":1233.53},
            {"nome":"Terceriza√ß√£o de Serv. (Instala√ß√µes)","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Custos Lastmile","valores":{"dia_1":0.0,"dia_2":2585.87,"dia_3":0.0,"dia_4":0.0,"dia_5":1550.78,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":3450.19,"dia_11":0.0,"dia_12":300.0,"dia_13":4529.34,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":4550.0,"dia_21":0.0,"dia_22":0.0,"dia_23":16974.23,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":33940.41}
      ],
      "despesas_operacionais": [{"nome":"Marketing","valores":{"dia_1":0.0,"dia_2":29963.88,"dia_3":0.0,"dia_4":0.0,"dia_5":4306.28,"dia_6":357.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":12229.58,"dia_11":0.0,"dia_12":0.0,"dia_13":1645.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":1166.0,"dia_20":1677.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":51344.74},
            {"nome":"Serv. Terceiros, jur√≠dicos e consultorias","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":2449.75,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":2410.05,"dia_11":2400.0,"dia_12":7500.0,"dia_13":12916.2,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":25.0,"dia_20":786.23,"dia_21":0.0,"dia_22":0.0,"dia_23":1400.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":29887.23},
            {"nome":"Viagens/Estadia","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Seguran√ßa Trabalho/ EPI","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":1392.0,"dia_10":0.0,"dia_11":487.0,"dia_12":0.0,"dia_13":162.42,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":2041.42},
            {"nome":"Desp. Aluguel de escrit√≥rio","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":582.75,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":26346.35,"dia_10":65.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":26994.1},
            {"nome":"Desp. Reformas empresa","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":446.72,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":832.91,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":20.0,"dia_20":894.08,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":2193.71},
            {"nome":"Material de uso, consumo e papelaria","valores":{"dia_1":0.0,"dia_2":169.8,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":15.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":143.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":327.8},
            {"nome":"Combustivel Adm","valores":{"dia_1":0.0,"dia_2":489.43,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":20.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":292.29,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":801.72},
            {"nome":"Despesas e taxas com Veiculos","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":430.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":214.15,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":11954.33,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":449.08,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":13047.56},
            {"nome":"Despesas Tribut√°rias/ Taxas legais","valores":{"dia_1":0.0,"dia_2":324.63,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":259.8,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":-13.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":571.43},
            {"nome":"Despesas Judiciais","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Treinamentos","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"Pr√≥-Labore","valores":{"dia_1":0.0,"dia_2":44133.2,"dia_3":100613.0,"dia_4":42917.99,"dia_5":12335.81,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":200000.0},
            {"nome":"Sistema","valores":{"dia_1":0.0,"dia_2":1091.7,"dia_3":0.0,"dia_4":0.0,"dia_5":3705.13,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":1134.45,"dia_10":6257.64,"dia_11":0.0,"dia_12":0.0,"dia_13":2855.12,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":6803.37,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":21847.41},
            {"nome":"Taxas Boleto","valores":{"dia_1":6.24,"dia_2":122.45,"dia_3":388.69,"dia_4":197.7,"dia_5":222.68,"dia_6":526.74,"dia_7":18.24,"dia_8":10.8,"dia_9":192.98,"dia_10":2375.62,"dia_11":715.8,"dia_12":139.58,"dia_13":145.44,"dia_14":10.32,"dia_15":11.28,"dia_16":12.72,"dia_17":9.6,"dia_18":198.76,"dia_19":530.08,"dia_20":234.96,"dia_21":9.84,"dia_22":6.48,"dia_23":587.46,"dia_24":52.68,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":6727.14},
            {"nome":"En√©rgia El√©trica escrit√≥rio","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":4977.36,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":4977.36},
            {"nome":"Despesas Diversas / Estacionamento","valores":{"dia_1":0.0,"dia_2":39.9,"dia_3":0.0,"dia_4":0.0,"dia_5":10.0,"dia_6":285.65,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":133.06,"dia_11":31.94,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":114.0,"dia_20":2187.5,"dia_21":0.0,"dia_22":0.0,"dia_23":913.46,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":3715.51},
            {"nome":"Tarifas banc√°rias","valores":{"dia_1":0.0,"dia_2":-358.94,"dia_3":131.85,"dia_4":10.73,"dia_5":10.74,"dia_6":13.46,"dia_7":0.0,"dia_8":0.0,"dia_9":18.66,"dia_10":24.21,"dia_11":108.57,"dia_12":6.73,"dia_13":12.05,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":13.35,"dia_19":16.26,"dia_20":8.15,"dia_21":0.0,"dia_22":0.0,"dia_23":15.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":30.82}
      ],
      "despesas_financeiras": [{"nome":"EBITDA","valores":{"dia_1":18632.1,"dia_2":3668.03,"dia_3":-34715.82,"dia_4":34533.59,"dia_5":-21475.34,"dia_6":-162097.03,"dia_7":26541.37,"dia_8":19383.92,"dia_9":-11645.77,"dia_10":112363.02,"dia_11":202256.73,"dia_12":74903.01,"dia_13":-38796.13,"dia_14":18209.01,"dia_15":17842.08,"dia_16":18487.14,"dia_17":14086.59,"dia_18":106215.04,"dia_19":79383.23,"dia_20":-159305.34,"dia_21":22737.15,"dia_22":12969.23,"dia_23":161635.78,"dia_24":33292.86,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":549104.45}],
      "ajustes_caixa": [{"nome":"Investimento","valores":{"dia_1":0.0,"dia_2":1900.0,"dia_3":0.0,"dia_4":0.0,"dia_5":51200.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":3611.8,"dia_10":0.0,"dia_11":1831.78,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":1265.56,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":59809.14},
            {"nome":"Empr/Finac/Parcel","valores":{"dia_1":0.0,"dia_2":13371.34,"dia_3":587.23,"dia_4":0.0,"dia_5":8846.13,"dia_6":24182.54,"dia_7":0.0,"dia_8":0.0,"dia_9":29546.52,"dia_10":12075.93,"dia_11":14184.74,"dia_12":163285.78,"dia_13":59237.31,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":45262.36,"dia_19":8680.0,"dia_20":7114.69,"dia_21":0.0,"dia_22":0.0,"dia_23":10319.32,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":396693.89},
            {"nome":"Impostos","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":0.0,"dia_6":0.0,"dia_7":0.0,"dia_8":0.0,"dia_9":0.0,"dia_10":0.0,"dia_11":0.0,"dia_12":0.0,"dia_13":0.0,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":0.0,"dia_19":0.0,"dia_20":0.0,"dia_21":0.0,"dia_22":0.0,"dia_23":0.0,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":0.0},
            {"nome":"S√≥cios ou Retiradas","valores":{"dia_1":0.0,"dia_2":0.0,"dia_3":0.0,"dia_4":0.0,"dia_5":3446.13,"dia_6":24182.54,"dia_7":0.0,"dia_8":0.0,"dia_9":23565.22,"dia_10":10623.18,"dia_11":12143.75,"dia_12":161899.0,"dia_13":18243.83,"dia_14":0.0,"dia_15":0.0,"dia_16":0.0,"dia_17":0.0,"dia_18":30094.0,"dia_19":1400.0,"dia_20":4752.76,"dia_21":0.0,"dia_22":0.0,"dia_23":9319.32,"dia_24":0.0,"dia_25":0.0,"dia_26":0.0,"dia_27":0.0,"dia_28":0.0,"dia_29":0.0,"dia_30":0.0,"dia_31":0.0},"total":299669.73}
      ]
      }
    };


    function showTab(cat,el) {
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      if(el) el.classList.add('active');
      renderTable(cat);
    }

    function toggleCategoria(categoria) {
      const rows = document.querySelectorAll(`.sub-${categoria}`);
      const icon = document.querySelector(`.expand-${categoria}`);
      rows.forEach(r => r.classList.toggle('hidden'));
      if (icon) icon.classList.toggle('expanded');
    }

    function renderTable(categoria) {
      const data = dadosFinanceiros[categoria];

      let html = `
        <table>
          <thead>
            <tr>
              <th>Categoria</th>
              <th class="value-cell">Jan/26</th>
              <th class="value-cell">Fev/26</th>
              <th class="value-cell">Mar/26</th>
              <th class="value-cell">Abr/26</th>
              <th class="value-cell">Mai/26</th>
              <th class="value-cell">Jun/26</th>
              <th class="value-cell">Jul/26</th>
              <th class="value-cell">Ago/26</th>
              <th class="value-cell">Set/26</th>
              <th class="value-cell">Out/26</th>
              <th class="value-cell">Nov/26</th>
              <th class="value-cell">Dez/26</th>
              <th class="value-cell">Total 2026</th>
            </tr>
          </thead>
          <tbody>
      `;

      /* ===================== EBITDA ===================== */
      if (categoria === 'ebitda') {
        const meses = ['jan', 'fev', 'mar', 'abr', 'mai', 'jun', 'jul', 'ago', 'set', 'out', 'nov', 'dez'];
        const ebitdaBase = dadosFinanceiros.ebitda[0];
        const ebitdaMensal = meses.map(mes => ebitdaBase[mes] || 0);
        const ebitdaTotal = ebitdaMensal.reduce((sum, val) => sum + val, 0);

        // Ajustes = todos exceto "EBITDA (Ajustado)"
        const ajustes = dadosFinanceiros.ebitda_ajustado.filter(i => i.nome !== 'EBITDA (Ajustado)');

        // EBITDA (Ajustado) usa o valor DIRETO da planilha, n√£o recalculado
        const ebitdaAjItem = dadosFinanceiros.ebitda_ajustado.find(i => i.nome === 'EBITDA (Ajustado)');
        const ebitdaAjMensal = meses.map(mes => ebitdaAjItem ? (ebitdaAjItem[mes] || 0) : 0);
        const ebitdaAjTotal  = ebitdaAjMensal.reduce((s,v) => s+v, 0);

        html += `
          <tr class="category-row" onclick="toggleCategoria('ebitda')">
            <td>
              <div class="category-header">
                <span class="expand-icon expand-ebitda">‚ñ∂</span>
                <strong>EBITDA</strong>
              </div>
            </td>
            ${ebitdaMensal.map(valor => `<td class="value-cell"><strong>${formatCurrency(valor)}</strong></td>`).join('')}
            <td class="value-cell"><strong>${formatCurrency(ebitdaTotal)}</strong></td>
          </tr>
        `;
        ajustes.forEach(item => {
          html += `
            <tr class="sub-item sub-ebitda hidden">
              <td>${item.nome}</td>
              ${meses.map(mes => `<td class="value-cell">${item[mes] ? formatCurrency(item[mes]) : '-'}</td>`).join('')}
              <td class="value-cell">${formatCurrency(item.total || 0)}</td>
            </tr>
          `;
        });
        html += `
          <tr class="category-row" onclick="toggleCategoria('ebitda-ajustado')">
            <td>
              <div class="category-header">
                <span class="expand-icon expand-ebitda-ajustado">‚ñ∂</span>
                <strong>EBITDA (Ajustado)</strong>
              </div>
            </td>
            ${ebitdaAjMensal.map(valor => `<td class="value-cell"><strong>${formatCurrency(valor)}</strong></td>`).join('')}
            <td class="value-cell"><strong>${formatCurrency(ebitdaAjTotal)}</strong></td>
          </tr>
          <tr class="sub-item sub-ebitda-ajustado hidden">
            <td>EBITDA (Ajustado)</td>
            ${ebitdaAjMensal.map(valor => `<td class="value-cell">${formatCurrency(valor)}</td>`).join('')}
            <td class="value-cell">${formatCurrency(ebitdaAjTotal)}</td>
          </tr>
          <tr class="sub-item sub-ebitda-ajustado hidden">
            <td>Folha / Receita Total</td>
            <td class="value-cell">31,05%</td>
            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
          </tr>
          <tr class="sub-item sub-ebitda-ajustado hidden">
            <td>Rescis√£o / Folha</td>
            <td class="value-cell">0,40%</td>
            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
          </tr>
          <tr class="sub-item sub-ebitda-ajustado hidden">
            <td>Folha / Receita Total - 2024</td>
            <td class="value-cell">22,80%</td>
            <td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td><td></td>
          </tr>
        `;
      }
      /* ===================== OUTRAS CATEGORIAS ===================== */
      else {
        const totalJan = data.reduce((acc, i) => acc + (i.jan || 0), 0);
        const totalFev = data.reduce((acc, i) => acc + (i.fev || 0), 0);
        const totalAno = data.reduce((acc, i) => acc + (i.total || 0), 0);

        html += `
          <tr class="category-row" onclick="toggleCategoria('${categoria}')">
            <td>
              <div class="category-header">
                <span class="expand-icon expand-${categoria}">‚ñ∂</span>
                <strong>${categoria.toUpperCase()}</strong>
              </div>
            </td>
            <td class="value-cell month-cell" onclick="event.stopPropagation();abrirModalDiario('JAN/26', '${categoria}')"><strong>${formatCurrency(totalJan)}</strong></td>
            <td class="value-cell month-cell" onclick="event.stopPropagation();abrirModalDiario('FEV/26', '${categoria}')"><strong>${formatCurrency(totalFev)}</strong></td>
            <td class="value-cell">-</td>
            <td class="value-cell">-</td>
            <td class="value-cell">-</td>
            <td class="value-cell">-</td>
            <td class="value-cell">-</td>
            <td class="value-cell">-</td>
            <td class="value-cell">-</td>
            <td class="value-cell">-</td>
            <td class="value-cell">-</td>
            <td class="value-cell">-</td>
            <td class="value-cell"><strong>${formatCurrency(totalAno)}</strong></td>
          </tr>
        `;
        data.forEach(item => {
          html += `
            <tr class="sub-item sub-${categoria} hidden">
              <td>${item.nome}</td>
              <td class="value-cell">${item.jan ? formatCurrency(item.jan) : '-'}</td>
              <td class="value-cell">${item.fev ? formatCurrency(item.fev) : '-'}</td>
              <td class="value-cell">-</td>
              <td class="value-cell">-</td>
              <td class="value-cell">-</td>
              <td class="value-cell">-</td>
              <td class="value-cell">-</td>
              <td class="value-cell">-</td>
              <td class="value-cell">-</td>
              <td class="value-cell">-</td>
              <td class="value-cell">-</td>
              <td class="value-cell">-</td>
              <td class="value-cell"><strong>${formatCurrency(item.total)}</strong></td>
            </tr>
          `;
        });
      }

      html += `</tbody></table>`;
      document.getElementById('tableContent').innerHTML = html;
    }

    function abrirModalDiario(mes, categoria) {
      const modal = document.getElementById('dailyModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalContent = document.getElementById('modalTableContent');
      const meses = { 'JAN/26': 'Janeiro 2026', 'FEV/26': 'Fevereiro 2026', 'MAR/26': 'Mar√ßo 2026' };
      modalTitle.textContent = `Detalhamento Di√°rio ‚Äî ${meses[mes] || mes} ‚Äî ${categoria.toUpperCase()}`;
      if (!dadosDiarios[mes]) {
        modalContent.innerHTML = '<p style="text-align:center;padding:2rem;color:#64748b;">Dados di√°rios n√£o dispon√≠veis para este m√™s.</p>';
        modal.classList.add('active'); return;
      }
      // Mapeia categorias do showTab para as chaves em dadosDiarios
      const catMap = { 'despesas': 'despesas_operacionais', 'ebitda': 'despesas_financeiras', 'ebitda_ajustado': 'despesas_financeiras' };
      const chave = catMap[categoria] || categoria;
      let dadosCategoria = dadosDiarios[mes][chave] || [];
      if (dadosCategoria.length === 0) {
        modalContent.innerHTML = '<p style="text-align:center;padding:2rem;color:#64748b;">Nenhum dado encontrado para esta categoria neste m√™s.</p>';
        modal.classList.add('active'); return;
      }
      // Detecta quantos dias tem o m√™s
      const diasPorMes = { 'JAN':31,'FEV':28,'MAR':31,'ABR':30,'MAI':31,'JUN':30,'JUL':31,'AGO':31,'SET':30,'OUT':31,'NOV':30,'DEZ':31 };
      const mesAbrev = mes.split('/')[0];
      const numDias = diasPorMes[mesAbrev] || 31;
      let html = '<table class="daily-table"><thead><tr><th>Item</th>';
      for (let dia = 1; dia <= numDias; dia++) html += `<th class="day-header">${dia}</th>`;
      html += '<th class="day-header">TOTAL</th></tr></thead><tbody>';
      dadosCategoria.forEach(item => {
        html += '<tr>';
        html += `<td><strong>${item.nome}</strong></td>`;
        for (let dia = 1; dia <= numDias; dia++) {
          const valor = item.valores[`dia_${dia}`] || 0;
          const cor = valor < 0 ? 'color:#b91c1c;' : '';
          html += `<td class="day-value" style="${cor}">${valor === 0 ? '-' : formatCurrency(valor)}</td>`;
        }
        const cor = item.total < 0 ? 'color:#b91c1c;' : '';
        html += `<td class="day-value" style="${cor}"><strong>${formatCurrency(item.total)}</strong></td></tr>`;
      });
      html += '<tr class="total-row"><td>TOTAL</td>';
      for (let dia = 1; dia <= numDias; dia++) {
        let totalDia = dadosCategoria.reduce((acc, item) => acc + (item.valores[`dia_${dia}`] || 0), 0);
        html += `<td class="day-value">${totalDia === 0 ? '-' : formatCurrency(totalDia)}</td>`;
      }
      const totalGeral = dadosCategoria.reduce((acc, item) => acc + item.total, 0);
      const corTotal = totalGeral < 0 ? 'color:#b91c1c;' : '';
      html += `<td class="day-value" style="${corTotal}"><strong>${formatCurrency(totalGeral)}</strong></td></tr>`;
      html += '</tbody></table>';
      modalContent.innerHTML = html;
      modal.classList.add('active');
    }

    function abrirModalTudoConsolidado() {
      const modal = document.getElementById('dailyModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalContent = document.getElementById('modalTableContent');
      // Usa o m√™s selecionado no filtro de per√≠odo do Consolidado
      const [anoSel, mesSel] = (document.getElementById('consolidadoPeriodo')?.value || '2026-01').split('-');
      const MESES_ABREV_KEY = ['JAN','FEV','MAR','ABR','MAI','JUN','JUL','AGO','SET','OUT','NOV','DEZ'];
      const MESES_NOME_FULL = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
      const mesIdx = parseInt(mesSel) - 1;
      const mes = MESES_ABREV_KEY[mesIdx] + '/' + anoSel.slice(2);
      modalTitle.textContent = `Fluxo de Caixa Detalhado ‚Äî ${MESES_NOME_FULL[mesIdx]} ${anoSel}`;
      if (!dadosDiarios[mes]) {
        modalContent.innerHTML = '<p style="text-align:center;padding:2rem;color:#64748b;">Dados n√£o dispon√≠veis.</p>';
        modal.classList.add('active'); return;
      }
      const categorias = [
        { chave: 'receitas', nome: 'RECEITAS' },
        { chave: 'impostos', nome: 'IMPOSTOS' },
        { chave: 'custos', nome: 'CUSTOS' },
        { chave: 'despesas_operacionais', nome: 'DESPESAS OPERACIONAIS' },
        { chave: 'despesas_financeiras', nome: 'DESPESAS FINANCEIRAS' },
        { chave: 'ajustes_caixa', nome: 'AJUSTES DE CAIXA' }
      ];
      let html = '<table class="daily-table"><thead><tr><th>Categoria / Subcategoria</th>';
      for (let dia = 1; dia <= 31; dia++) html += `<th class="day-header">${dia}</th>`;
      html += '<th class="day-header">TOTAL</th></tr></thead><tbody>';
      let totalGeralTudo = 0;
      let totaisDiarios = {};
      for (let dia = 1; dia <= 31; dia++) totaisDiarios[`dia_${dia}`] = 0;
      categorias.forEach(catInfo => {
        const dadosCategoria = dadosDiarios[mes][catInfo.chave] || [];
        if (dadosCategoria.length > 0) {
          html += `<tr style="background:#e0f2fe;font-weight:700;"><td colspan="33" style="padding:1rem;font-size:1rem;">${catInfo.nome}</td></tr>`;
          dadosCategoria.forEach(item => {
            html += '<tr>';
            html += `<td style="padding-left:2rem;">${item.nome}</td>`;
            for (let dia = 1; dia <= 31; dia++) {
              const valor = item.valores[`dia_${dia}`] || 0;
              html += `<td class="day-value">${valor === 0 ? '-' : formatCurrency(valor)}</td>`;
              totaisDiarios[`dia_${dia}`] += valor;
            }
            html += `<td class="day-value"><strong>${formatCurrency(item.total)}</strong></td></tr>`;
            totalGeralTudo += item.total;
          });
          const totalCategoria = dadosCategoria.reduce((acc, item) => acc + item.total, 0);
          html += '<tr style="background:#f1f5f9;font-weight:600;">';
          html += `<td style="padding-left:1rem;">SUBTOTAL ${catInfo.nome}</td>`;
          for (let dia = 1; dia <= 31; dia++) {
            let totalDiaCategoria = dadosCategoria.reduce((acc, item) => acc + (item.valores[`dia_${dia}`] || 0), 0);
            html += `<td class="day-value">${totalDiaCategoria === 0 ? '-' : formatCurrency(totalDiaCategoria)}</td>`;
          }
          html += `<td class="day-value">${formatCurrency(totalCategoria)}</td></tr>`;
        }
      });
      html += '<tr class="total-row" style="background:#2563eb;color:white;"><td><strong>TOTAL GERAL</strong></td>';
      for (let dia = 1; dia <= 31; dia++) {
        html += `<td class="day-value" style="color:white;">${totaisDiarios[`dia_${dia}`] === 0 ? '-' : formatCurrency(totaisDiarios[`dia_${dia}`])}</td>`;
      }
      html += `<td class="day-value" style="color:white;"><strong>${formatCurrency(totalGeralTudo)}</strong></td></tr>`;
      html += '</tbody></table>';
      modalContent.innerHTML = html;
      modal.classList.add('active');
    }

    function abrirModalConsolidadoAnual() {
      const modal = document.getElementById('dailyModal');
      const modalTitle = document.getElementById('modalTitle');
      const modalContent = document.getElementById('modalTableContent');
      const ano = document.getElementById('consolidadoAnoFiltro')?.value || '2026';
      modalTitle.textContent = `Consolidado Anual ‚Äî ${ano}`;

      const MESES   = ['jan','fev','mar','abr','mai','jun','jul','ago','set','out','nov','dez'];
      const LABELS  = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];

      const categorias = [
        { chave:'receitas',           nome:'RECEITAS' },
        { chave:'impostos',           nome:'IMPOSTOS' },
        { chave:'custos',             nome:'CUSTOS' },
        { chave:'despesas',           nome:'DESPESAS OPERACIONAIS' },
        { chave:'ebitda',             nome:'EBITDA' },
        { chave:'ebitda_ajustado',    nome:'EBITDA AJUSTADO' },
        { chave:'ajustes',            nome:'AJUSTES DE CAIXA' },
        { chave:'bancos',             nome:'BANCOS' },
      ];

      // Cabe√ßalho
      let html = `<table class="daily-table"><thead><tr>
        <th style="min-width:220px;text-align:left;padding:0.75rem 1rem;">Categoria / Subcategoria</th>`;
      LABELS.forEach(l => { html += `<th class="day-header">${l}</th>`; });
      html += `<th class="day-header" style="background:#1e3a8a;color:white;">TOTAL</th></tr></thead><tbody>`;

      // Totais gerais por m√™s
      const totalGeralMes = {};
      MESES.forEach(m => totalGeralMes[m] = 0);
      let totalGeralAno = 0;

      categorias.forEach(catInfo => {
        const itens = dadosFinanceiros[catInfo.chave] || [];
        if (itens.length === 0) return;

        // Linha de categoria
        html += `<tr style="background:#e0f2fe;font-weight:700;">
          <td colspan="${MESES.length + 2}" style="padding:0.75rem 1rem;font-size:0.95rem;letter-spacing:0.03em;">${catInfo.nome}</td></tr>`;

        // Totais da categoria por m√™s
        const subtotalMes = {};
        MESES.forEach(m => subtotalMes[m] = 0);
        let subtotalAno = 0;

        itens.forEach(item => {
          html += `<tr><td style="padding:0.5rem 0.75rem 0.5rem 2rem;font-size:0.85rem;">${item.nome}</td>`;
          let rowTotal = 0;
          MESES.forEach(m => {
            const v = item[m] || 0;
            subtotalMes[m] += v;
            rowTotal += v;
            const cor = v < 0 ? 'color:#b91c1c;' : '';
            html += `<td class="day-value" style="${cor}">${v === 0 ? '<span style="color:#cbd5e1">‚Äî</span>' : formatCurrency(v)}</td>`;
          });
          // usa total do objeto se existir, sen√£o soma dos meses
          const tot = item.total !== undefined ? item.total : rowTotal;
          subtotalAno += tot;
          const corTot = tot < 0 ? 'color:#b91c1c;' : '';
          html += `<td class="day-value" style="font-weight:700;${corTot}">${formatCurrency(tot)}</td></tr>`;
        });

        // Linha de subtotal da categoria
        html += `<tr style="background:#f1f5f9;font-weight:700;border-top:2px solid #e2e8f0;">
          <td style="padding:0.6rem 0.75rem 0.6rem 1rem;font-size:0.85rem;">SUBTOTAL ${catInfo.nome}</td>`;
        MESES.forEach(m => {
          const v = subtotalMes[m];
          const cor = v < 0 ? 'color:#b91c1c;' : 'color:#1e3a8a;';
          html += `<td class="day-value" style="${cor}">${v === 0 ? '‚Äî' : formatCurrency(v)}</td>`;
          totalGeralMes[m] += v;
        });
        html += `<td class="day-value" style="color:#1e3a8a;font-weight:800;">${formatCurrency(subtotalAno)}</td></tr>`;
        totalGeralAno += subtotalAno;

        // Espa√ßo visual entre categorias
        html += `<tr style="height:6px;background:#f8fafc;"><td colspan="${MESES.length + 2}"></td></tr>`;
      });

      // Linha de total geral
      html += `<tr style="background:linear-gradient(135deg,#1e3a8a,#2563eb);color:white;font-weight:800;font-size:0.95rem;">
        <td style="padding:0.9rem 1rem;">TOTAL GERAL ${ano}</td>`;
      MESES.forEach(m => {
        const v = totalGeralMes[m];
        html += `<td class="day-value" style="color:white;">${v === 0 ? '‚Äî' : formatCurrency(v)}</td>`;
      });
      html += `<td class="day-value" style="color:white;font-size:1.05rem;">${formatCurrency(totalGeralAno)}</td></tr>`;
      html += `</tbody></table>`;

      modalContent.innerHTML = html;
      modal.classList.add('active');
    }

    function showCompTab(cat,el) {
      document.querySelectorAll('.tab-btn').forEach(b=>b.classList.remove('active'));
      if(el) el.classList.add('active');
      renderCompTab(cat);
    }

    function renderCompTab(cat) {
      const map = {'receitas-comp':['receitas','Receitas Totais'],'custos-comp':['custos','Custos Totais'],'despesas-comp':['despesas','Despesas Totais'],'ebitda-comp':['ebitda','EBITDA']};
      const [key,label] = map[cat]||['receitas','Receitas'];
      const v26=dadosComparativos[2026][key],v25=dadosComparativos[2025][key],v24=dadosComparativos[2024][key];
      const var2524=((v25-v24)/v24*100).toFixed(1),var2625=((v26-v25)/v25*100).toFixed(1);
      document.getElementById('compTableContent').innerHTML = `<table style="min-width:700px"><thead><tr><th>${label}</th><th class="value-cell">2024</th><th class="value-cell">2025</th><th class="value-cell">2026</th><th class="value-cell">Var 25/24</th><th class="value-cell">Var 26/25</th></tr></thead><tbody>
        <tr class="total-row"><td>${label}</td><td class="value-cell">${formatCurrency(v24)}</td><td class="value-cell">${formatCurrency(v25)}</td><td class="value-cell">${formatCurrency(v26)}</td>
        <td class="value-cell ${v25>v24?'positive-value':'negative-value'}">+${var2524}%</td>
        <td class="value-cell ${v26>v25?'positive-value':'negative-value'}">+${var2625}%</td></tr>
      </tbody></table>`;
    }

    function renderComparisonCards() {
      const anos = [2024,2025,2026];
      const indicadores = [{k:'receitas',l:'Receitas'},{k:'custos',l:'Custos'},{k:'despesas',l:'Despesas'},{k:'ebitda',l:'EBITDA'},{k:'ebitdaAjustado',l:'EBITDA Aj.'}];
      let html = '';
      indicadores.forEach(({k,l}) => {
        html += `<div class="comparison-card"><div class="comparison-card-title">${l}</div>`;
        anos.forEach(ano => {
          const v = dadosComparativos[ano][k];
          const vp = ano>2024?dadosComparativos[ano-1][k]:null;
          const var_ = vp?((v-vp)/vp*100).toFixed(1):null;
          html += `<div class="comparison-item"><span class="comparison-label">${ano}</span><div><div class="comparison-value ${v>=(vp||v)?'positive':'negative'}">${formatCurrency(v)}</div>${var_?`<div class="comparison-variation">+${var_}%</div>`:''}</div></div>`;
        });
        html += '</div>';
      });
      document.getElementById('comparisonGrid').innerHTML = html;
    }

    function selectYear(y,ev) {
      anoSelecionadoComparativo = y;
      document.querySelectorAll('.year-btn').forEach(b=>b.classList.remove('active'));
      ev.target.classList.add('active');
      renderComparisonCards();
      renderCompTab('receitas-comp');
    }

    // ==================== CHARTS ====================
    let charts = {};
    function renderizarGraficos() {
      Object.values(charts).forEach(c=>c.destroy&&c.destroy());
      charts = {};
      const rec = dadosFinanceiros.receitas;
      const recLabels = rec.map(r=>r.nome);
      const recVals = rec.map(r=>r.jan);
      charts.receitas = new Chart(document.getElementById('receitasChart'),{type:'doughnut',data:{labels:recLabels,datasets:[{data:recVals,backgroundColor:['#2563eb','#10b981','#f59e0b','#ef4444','#8b5cf6','#06b6d4','#ec4899','#84cc16']}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{boxWidth:12,font:{size:10}}}}}});
      const desp = dadosFinanceiros.despesas;
      charts.despesas = new Chart(document.getElementById('despesasChart'),{type:'pie',data:{labels:desp.map(d=>d.nome),datasets:[{data:desp.map(d=>d.jan),backgroundColor:['#ef4444','#f97316','#eab308','#84cc16','#10b981','#06b6d4','#3b82f6']}]},options:{responsive:true,maintainAspectRatio:false,plugins:{legend:{position:'bottom',labels:{boxWidth:12,font:{size:10}}}}}});
      charts.comp = new Chart(document.getElementById('comparativoReceitasChart'),{type:'bar',data:{labels:MTHS_L,datasets:[{label:'Receitas',data:[2720556,560487,0,0,0,0,0,0,0,0,0,0],backgroundColor:'rgba(37,99,235,0.7)'},{label:'Custos',data:[1888295,300000,0,0,0,0,0,0,0,0,0,0],backgroundColor:'rgba(239,68,68,0.7)'}]},options:{responsive:true,maintainAspectRatio:false,scales:{y:{beginAtZero:true,ticks:{callback:v=>'R$'+v.toLocaleString('pt-BR')}}}}});
      const top10 = [...dadosFinanceiros.custos].sort((a,b)=>b.jan-a.jan).slice(0,10);
      charts.custos = new Chart(document.getElementById('custosChart'),{type:'bar',data:{labels:top10.map(c=>c.nome.substr(0,20)),datasets:[{label:'Jan 2026',data:top10.map(c=>c.jan),backgroundColor:'rgba(245,158,11,0.7)'}]},options:{responsive:true,maintainAspectRatio:false,indexAxis:'y',scales:{x:{beginAtZero:true}}}});
    }

    // ==================== DIRETORIA ====================
    const CAMPOS = [
      { key: 'base_pf',      label: 'Base Clientes PF'      },
      { key: 'base_pj',      label: 'Base Clientes PJ +PME' },
      { key: 'base_isentos', label: 'Base Isentos'          },
      { key: 'contratos',    label: 'Base de Contratos'     },
      { key: 'os_pf',        label: 'OS Suporte PF'         },
      { key: 'os_pj',        label: 'OS Suporte PJ'         },
      { key: 'nc_pf',        label: 'Novos Clientes PF'     },
      { key: 'nc_pj',        label: 'Novos Clientes PJ'     },
      { key: 'canc_pf',      label: 'Cancelamento PF'       },
      { key: 'canc_pj',      label: 'Cancelam. PME + PJ'    },
      { key: 'retiradas',    label: 'Retiradas'             },
      { key: 'canc_sr',      label: 'Can S/ Retirada'       },
      { key: 'reat_ret',     label: 'Reativacoes Retirada'  },
      { key: 'nn',           label: 'Novos Neg√≥cios'        },
      { key: 'nn_pf',        label: 'Novos Neg√≥cios PF'     },
      { key: 'nn_pj',        label: 'Novos Neg√≥cios PJ'     },
      { key: 'upgrade',      label: 'Upgrade'               },
      { key: 'reat',         label: 'Reativacoes'           },
      { key: 'val_canc',     label: 'Valor Cancelamento'    },
      { key: 'val_canc_pf',  label: 'Valor Cancelamento PF' },
      { key: 'val_canc_pj',  label: 'Valor Canc. PJ + PME'  },
      { key: 'downgrade',    label: 'Downgrade'             },
      { key: 'resultado',    label: 'Resultado Liquido'     },
      { key: 'juros45',      label: 'Juros < 45'            },
      { key: 'juros45m',     label: 'Juros >45'             },
      { key: 'reajuste',     label: 'Reajuste Contratos'    },
    ];

    function parseBR(s) {
      if (!s) return null;
      s = String(s).replace(/R\$\s*/g, '').trim();
      const neg = s.startsWith('-');
      s = s.replace(/-/g, '').trim();
      if (!s || s === '(Em branco)') return null;
      if (/\d\.\d{3},/.test(s)) s = s.replace(/\./g,'').replace(',','.');
      else if (/,\d{1,2}$/.test(s)) s = s.replace(',','.');
      const v = parseFloat(s);
      return isNaN(v) ? null : (neg ? -v : v);
    }

    function lerPdf(words) {
      const linhas = [];
      for (const w of words.sort((a,b)=>a.y-b.y)) {
        const l = linhas.find(l => Math.abs(l.y - w.y) <= 12);
        if (l) l.ws.push(w);
        else linhas.push({y: w.y, ws: [w]});
      }
      const rows = linhas.map(l => {
        const ws = l.ws.sort((a,b)=>a.x-b.x);
        const LE = ws.filter(w=>w.x<530 && !/\d/.test(w.text) && !['R$','+'].includes(w.text)).map(w=>w.text).join(' ').trim();
        let VE = null;
        for (const w of ws) if (w.x>=530 && w.x<700 && /\d/.test(w.text)) { VE=parseBR(w.text); break; }
        const LD = ws.filter(w=>w.x>=800 && w.x<1080 && !['R$','(Em','branco)'].includes(w.text)).map(w=>w.text).join(' ').trim();
        const negD = ws.some(w=>w.x>=1080 && (w.text==='-R$'||w.text.startsWith('-R$')));
        let VD = null;
        for (const w of ws) {
          if (w.x>=1080 && w.text!=='R$' && w.text!=='-R$' && !w.text.startsWith('(')) {
            const v = parseBR(w.text);
            if (v!==null) { VD = negD ? -Math.abs(v) : v; break; }
          }
        }
        return {y:l.y, LE, VE, LD, VD};
      });
      const getVal = (i, side) => {
        const v = rows[i]['V'+side];
        if (v !== null) return v;
        if (i>0 && rows[i].y - rows[i-1].y <= 22) return rows[i-1]['V'+side];
        return null;
      };
      const mapa = {};
      rows.forEach((r,i)=>{
        if (r.LE) mapa[r.LE] = getVal(i,'E');
        if (r.LD) mapa[r.LD] = getVal(i,'D');
      });
      const n = s => s.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ').trim();
      const get = lbl => {
        for (const [k,v] of Object.entries(mapa)) if (n(k)===n(lbl)) return v;
        for (const [k,v] of Object.entries(mapa)) if (n(k).includes(n(lbl))||n(lbl).includes(n(k))) return v;
        return null;
      };
      return {
        base_pf: get('Basse Clientes PF'), base_pj: get('Base Clientes PJ'),
        base_isentos: get('Base Isentos'), contratos: get('Base de Contratos'),
        os_pf: get('OS Suporte PF'), os_pj: get('OS Suporte PJ'),
        nc_pf: get('Novos Clientes PF'), nc_pj: get('Novos Clientes PJ'),
        canc_pf: get('Cancelamento PF'), canc_pj: get('Cancelam.'),
        retiradas: get('Retiradas'), canc_sr: get('Can S/'),
        reat_ret: get('Reativacoes Retirada'), nn: get('Novos Neg√≥cios'),
        nn_pf: get('Novos Neg√≥cios PF'), nn_pj: get('Novos Neg√≥cios PJ'),
        upgrade: get('Upgrade'), reat: mapa['Reativacoes'] ?? mapa['Reativa√ß√µes'] ?? null,
        val_canc: mapa['Valor Cancelamento'] ?? null, val_canc_pf: get('Valor Cancelamento PF'),
        val_canc_pj: get('Valor Canc.'), downgrade: get('Downgrade'),
        resultado: get('Resultado'), juros45: get('Juros < 45'),
        juros45m: get('Juros >45'), reajuste: null,
      };
    }

    async function diretoriaCarregarPdf(input) {
      const file = input.files[0];
      if (!file) return;
      const loading = document.getElementById('diretoriaLoadingOCR');
      const status  = document.getElementById('diretoriaOCRStatus');
      const bar     = document.getElementById('diretoriaOCRBar');
      loading.style.display = 'block';
      status.textContent = 'Lendo PDF...';
      bar.style.width = '20%';
      document.getElementById('diretoriaPreviewSection').style.display = 'none';
      document.getElementById('diretoriaPdfInfo').style.display = 'none';
      try {
        const buf = await file.arrayBuffer();
        const lib = window['pdfjs-dist/build/pdf'];
        lib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
        const pdf = await lib.getDocument(new Uint8Array(buf)).promise;
        bar.style.width = '50%';
        let words = [];
        for (let p=1; p<=pdf.numPages; p++) {
          const page = await pdf.getPage(p);
          const vp   = page.getViewport({scale:1});
          const ct   = await page.getTextContent();
          ct.items.forEach(item => {
            const x = item.transform[4];
            const y = vp.height - item.transform[5];
            const t = item.str.trim();
            if (t) words.push({x,y,text:t});
          });
        }
        bar.style.width = '80%';
        const dados = lerPdf(words);
        const txt = words.map(w=>w.text).join(' ').toLowerCase();
        const MESES_NOME = ['janeiro','fevereiro','marco','abril','maio','junho','julho','agosto','setembro','outubro','novembro','dezembro'];
        const mes = MESES_NOME.findIndex(m => txt.includes(m) || txt.includes(m.normalize('NFD').replace(/[\u0300-\u036f]/g,'')));
        const anoM = txt.match(/20(\d\d)/);
        const ano = anoM ? parseInt('20'+anoM[1]) : 2026;
        bar.style.width = '100%';
        loading.style.display = 'none';
        document.getElementById('diretoriaPdfInfo').style.display = 'block';
        document.getElementById('diretoriaPdfNome').textContent = file.name;
        if (mes>=0) document.getElementById('dirMes').value = mes;
        document.getElementById('dirAno').value = ano;
        diretoriaDadosExtraidos = dados;
        diretoriaMostrarGrid(dados);
        document.getElementById('diretoriaPreviewSection').style.display = 'block';
        // Verifica se j√° existe registro ‚Äî s√≥ atualiza o aviso, N√ÉO esconde o grid
        diretoriaAtualizarAviso(mes, ano);
      } catch(e) {
        loading.style.display = 'none';
        alert('Erro: '+e.message);
      }
      input.value='';
    }

    function diretoriaMostrarGrid(dados) {
      const grid = document.getElementById('diretoriaDataGrid');
      grid.innerHTML = '';
      CAMPOS.forEach(c => {
        const val = dados[c.key];
        const div = document.createElement('div');
        div.style.cssText = 'background:#f8fafc;border:1px solid #e2e8f0;border-radius:8px;padding:0.75rem 1rem;display:flex;justify-content:space-between;align-items:center;gap:0.5rem;';
        const lbl = document.createElement('span');
        lbl.style.cssText = 'font-size:0.85rem;color:#475569;flex-shrink:0;font-weight:500;';
        lbl.textContent = c.label;
        const inp = document.createElement('input');
        inp.type = 'text';
        inp.dataset.key = c.key;
        inp.value = val !== null && val !== undefined ? val : '';
        inp.placeholder = '‚Äî';
        const cor = val===null||val===undefined ? '#94a3b8' : (val<0 ? '#b91c1c' : '#166534');
        inp.style.cssText = `width:120px;text-align:right;border:1px solid #cbd5e1;border-radius:6px;padding:0.3rem 0.6rem;font-weight:700;font-size:0.92rem;color:${cor};background:white;`;
        inp.oninput = function() { diretoriaDadosExtraidos[c.key] = parseBR(this.value); };
        div.appendChild(lbl); div.appendChild(inp); grid.appendChild(div);
      });
    }

    // ==================== STORAGE DIRETORIA ====================
    // Chave: "diretoria_YYYY_MM" ‚Äî sobrescreve sempre que mesmo mes/ano √© carregado
    const DIRETORIA_STORAGE_PREFIX = 'diretoria_';

    function diretoriaStorageKey(mes, ano) {
      const mm = String(parseInt(mes)+1).padStart(2,'0');
      return DIRETORIA_STORAGE_PREFIX + ano + '_' + mm;
    }

    // S√≥ atualiza o aviso de "j√° existe", sem tocar no grid
    async function diretoriaAtualizarAviso(mes, ano) {
      const info = document.getElementById('dirStorageInfo');
      if (!info) return;
      const MESES_N = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];
      const existente = await diretoriaLerDados(mes, ano);
      if (existente) {
        const dt = new Date(existente.savedAt);
        const dtStr = dt.toLocaleDateString('pt-BR') + ' ' + dt.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
        info.innerHTML = `<span style="color:#d97706">‚ö†Ô∏è J√° existe dados de ${MESES_N[mes]}/${ano} salvos (${dtStr}) ‚Äî ao salvar ir√° <strong>substituir</strong></span>`;
      } else {
        info.innerHTML = `<span style="color:#64748b">Nenhum dado salvo para ${MESES_N[mes]}/${ano} ainda</span>`;
      }
    }

    async function diretoriaSalvarDados(mes, ano, dados) {
      const key = diretoriaStorageKey(mes, ano);
      try {
        // Apaga o antigo antes de salvar (garante substitui√ß√£o limpa)
        await sbStorage.remove(key);
        await sbStorage.set(key, JSON.stringify({ mes, ano, dados, savedAt: new Date().toISOString() }));
        return true;
      } catch(e) { return false; }
    }

    async function diretoriaLerDados(mes, ano) {
      const key = diretoriaStorageKey(mes, ano);
      try {
        const raw = await sbStorage.get(key);
        return raw ? JSON.parse(raw) : null;
      } catch(e) { return null; }
    }

    // Ao abrir a aba, busca o m√™s mais recente salvo no Supabase e exibe automaticamente
    async function diretoriaCarregarUltimoMes() {
      // Se j√° tem dados na tela, s√≥ atualiza aviso
      if (diretoriaDadosExtraidos) {
        await diretoriaVerificarMesAno();
        return;
      }

      const ano = document.getElementById('dirAno')?.value ?? '2026';
      const mesAtual = new Date().getMonth(); // 0-11

      // Tenta do m√™s atual para tr√°s at√© encontrar um com dados
      for (let m = mesAtual; m >= 0; m--) {
        const dados = await diretoriaLerDados(m, ano);
        if (dados && dados.dados) {
          // Achou! Seleciona esse m√™s no dropdown e exibe
          document.getElementById('dirMes').value = m;
          diretoriaDadosExtraidos = dados.dados;
          diretoriaMostrarGrid(dados.dados);
          document.getElementById('diretoriaPreviewSection').style.display = 'block';
          document.getElementById('diretoriaPdfInfo').style.display = 'block';
          document.getElementById('diretoriaPdfNome').textContent = `üì¶ Carregado do Supabase ‚Äî ${['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'][m]}/${ano}`;
          const dt = new Date(dados.savedAt);
          const dtStr = dt.toLocaleDateString('pt-BR') + ' ' + dt.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
          const info = document.getElementById('dirStorageInfo');
          if (info) info.innerHTML = `<span style="color:#059669">‚úÖ Dados de ${['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'][m]}/${ano} carregados (${dtStr})</span>`;
          return;
        }
      }

      // Nenhum m√™s encontrado ‚Äî exibe mensagem
      await diretoriaVerificarMesAno();
    }

    async function diretoriaVerificarMesAno() {
      const mes = parseInt(document.getElementById('dirMes')?.value ?? 0);
      const ano = document.getElementById('dirAno')?.value ?? '2026';
      const info = document.getElementById('dirStorageInfo');
      if (!info) return;
      const MESES_N = ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];

      // Se j√° tem PDF carregado na tela, s√≥ atualiza o aviso sem tocar no grid
      if (diretoriaDadosExtraidos) {
        await diretoriaAtualizarAviso(mes, ano);
        return;
      }

      // Sem PDF carregado ‚Äî busca do Supabase e exibe
      const existente = await diretoriaLerDados(mes, ano);
      if (existente && existente.dados) {
        const dt = new Date(existente.savedAt);
        const dtStr = dt.toLocaleDateString('pt-BR') + ' ' + dt.toLocaleTimeString('pt-BR',{hour:'2-digit',minute:'2-digit'});
        info.innerHTML = `<span style="color:#059669">‚úÖ Dados de ${MESES_N[mes]}/${ano} carregados do Supabase (${dtStr})</span>`;
        diretoriaDadosExtraidos = existente.dados;
        diretoriaMostrarGrid(existente.dados);
        document.getElementById('diretoriaPreviewSection').style.display = 'block';
        const pdfInfo = document.getElementById('diretoriaPdfInfo');
        const pdfNome = document.getElementById('diretoriaPdfNome');
        if (pdfInfo) pdfInfo.style.display = 'block';
        if (pdfNome) pdfNome.textContent = `üì¶ Carregado do Supabase ‚Äî ${MESES_N[mes]}/${ano}`;
      } else {
        info.innerHTML = `<span style="color:#64748b">Nenhum dado salvo para ${MESES_N[mes]}/${ano} ainda</span>`;
        document.getElementById('diretoriaPreviewSection').style.display = 'none';
        document.getElementById('diretoriaPdfInfo').style.display = 'none';
      }
    }

    async function diretoriaCarregarInformacoes() {
      const dados = diretoriaGetDados();
      const mes = parseInt(document.getElementById('dirMes').value);
      const ano = document.getElementById('dirAno').value;
      const MESES_N = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
      const foiSubstituicao = !!(await diretoriaLerDados(mes, ano));
      const ok = await diretoriaSalvarDados(mes, ano, dados);
      const msg = document.getElementById('dirSalvoMsg');
      if (ok) {
        msg.style.display = 'block';
        if (foiSubstituicao) {
          msg.style.background = '#fef3c7'; msg.style.color = '#92400e'; msg.style.border = '1px solid #fde68a';
          msg.innerHTML = `üîÑ Dados de <strong>${MESES_N[mes]}/${ano}</strong> substitu√≠dos com sucesso!`;
        } else {
          msg.style.background = '#f0fdf4'; msg.style.color = '#166534'; msg.style.border = '1px solid #86efac';
          msg.innerHTML = `‚úÖ Dados de <strong>${MESES_N[mes]}/${ano}</strong> salvos no Supabase! Dispon√≠veis para dashboards e relat√≥rios.`;
        }
        await diretoriaAtualizarAviso(mes, ano);
        // Garante que o grid permanece vis√≠vel ap√≥s salvar
        document.getElementById('diretoriaPreviewSection').style.display = 'block';
        document.getElementById('diretoriaPdfInfo').style.display = 'block';
        setTimeout(() => { msg.style.display = 'none'; }, 5000);
      } else {
        msg.style.display = 'block';
        msg.style.background = '#fef2f2'; msg.style.color = '#991b1b'; msg.style.border = '1px solid #fca5a5';
        msg.innerHTML = '‚ùå Erro ao salvar no Supabase. Verifique a conex√£o.';
      }
    }

    function diretoriaGetDados() {
      const d = {};
      document.querySelectorAll('#diretoriaDataGrid input[data-key]').forEach(i => {
        d[i.dataset.key] = parseBR(i.value);
      });
      return d;
    }

    // ==================== COMISS√ÉO FINANCEIRO ====================
    // ==================== COMISS√ÉO FINANCEIRO ====================
    const MESES_KEY  = ['jan','fev','mar','abr','mai','jun','jul','ago','set','out','nov','dez'];
    const MESES_NOME = ['Janeiro','Fevereiro','Mar√ßo','Abril','Maio','Junho','Julho','Agosto','Setembro','Outubro','Novembro','Dezembro'];
    const MESES_ABREV= ['Jan','Fev','Mar','Abr','Mai','Jun','Jul','Ago','Set','Out','Nov','Dez'];

    // L√™ par√¢metro num√©rico da aba Par√¢metros (DOM)
    function getParam(id, fallback) {
      const el = document.getElementById(id);
      return el ? (parseFloat(el.value) || fallback) : fallback;
    }

    // L√™ dados do Diretoria PDF ‚Äî via Supabase
    async function getDiretoriaDados(mes, ano) {
      const mm = String(mes + 1).padStart(2, '0');
      const key = 'diretoria_' + ano + '_' + mm;
      try {
        const raw = await sbStorage.get(key);
        return raw ? JSON.parse(raw) : null;
      } catch(e) { return null; }
    }

    // Soma um campo de receitas para um m√™s
    // Faturamento BASE = s√≥ Link PF + Link PJ (igual √† planilha)
    function getFaturamento(mesKey) {
      const nomes = ['Link Pessoa F√≠sica', 'Link Pessoa Jur√≠dica'];
      return dadosFinanceiros.receitas
        .filter(r => nomes.includes(r.nome))
        .reduce((s, r) => s + (r[mesKey] || 0), 0);
    }
    // Faturamento TOTAL (todas receitas) ‚Äî para cards de exibi√ß√£o
    function getFaturamentoTotal(mesKey) {
      return dadosFinanceiros.receitas.reduce((s, r) => s + (r[mesKey] || 0), 0);
    }
    function getJuros(mesKey) {
      const j = dadosFinanceiros.receitas.find(r => r.nome === 'Juros/Multa');
      return j ? (j[mesKey] || 0) : 0;
    }
    function getTarifas(mesKey) {
      const t = dadosFinanceiros.despesas.find(r => r.nome === 'Tarifas banc√°rias');
      return t ? (t[mesKey] || 0) : 0;
    }
    function getEbitda(mesKey) {
      // Usa o valor direto "EBITDA (Ajustado)" da planilha ‚Äî n√£o recalcula
      const e = dadosFinanceiros.ebitda_ajustado.find(r => r.nome === 'EBITDA (Ajustado)');
      return e ? (e[mesKey] || 0) : 0;
    }

    // Badge de status
    function badgeStatus(ok, textoOk, textoFail) {
      return ok
        ? `<span style="background:#dcfce7;color:#166534;padding:0.25rem 0.75rem;border-radius:20px;font-size:0.78rem;font-weight:700">‚úì ${textoOk}</span>`
        : `<span style="background:#fee2e2;color:#991b1b;padding:0.25rem 0.75rem;border-radius:20px;font-size:0.78rem;font-weight:700">‚úó ${textoFail}</span>`;
    }

    // Linha de indicador da matriz
    function indicadorRow(icon, nome, detalhe, status, comissao) {
      const cor = comissao > 0 ? '#059669' : '#94a3b8';
      return `
        <div style="display:grid;grid-template-columns:2fr 3fr auto 1fr;align-items:center;gap:1rem;padding:1rem 1.25rem;background:#f8fafc;border-radius:12px;border-left:4px solid ${comissao>0?'#059669':'#e2e8f0'}">
          <div>
            <div style="font-size:0.75rem;color:#64748b;font-weight:600;margin-bottom:0.2rem">${icon} ${nome}</div>
          </div>
          <div style="font-size:0.82rem;color:#334155;line-height:1.7">${detalhe}</div>
          <div>${status}</div>
          <div style="text-align:right">
            <div style="font-size:0.7rem;color:#94a3b8;margin-bottom:0.1rem">Comiss√£o</div>
            <div style="font-size:1.1rem;font-weight:700;color:${cor}">${comissao > 0 ? formatCurrency(comissao) : '‚Äî'}</div>
          </div>
        </div>`;
    }

    // ==================== FECHAR M√äS ====================
    async function fecharMes() {
      const mesIdx = parseInt(document.getElementById('comissaoMesFiltro')?.value ?? 0);
      const ano    = document.getElementById('comissaoAnoFiltro')?.value ?? '2026';
      const mesNome = MESES_NOME[mesIdx];
      const mesKey  = MESES_KEY[mesIdx];

      const conf = confirm(`Fechar ${mesNome}/${ano}?\n\nIsso ir√° CONGELAR todos os dados e c√°lculos deste m√™s.\nMesmo que os par√¢metros mudem no futuro, este m√™s n√£o ser√° afetado.\n\nEsta a√ß√£o pode ser desfeita clicando em "Reabrir".`);
      if (!conf) return;

      // Coleta snapshot completo dos dados e c√°lculos atuais
      const params = {};
      ['param_metaJuros','param_txComissaoJuros','param_txRecorrencia','param_limTarifas',
       'param_txEficiencia','param_txEbitdaMensal','param_txBonusTrim',
       'metaEbitda_'+mesKey,'metaTrim_q1','metaTrim_q2','metaTrim_q3','metaTrim_q4'
      ].forEach(id => {
        const el = document.getElementById(id);
        if (el) params[id] = parseFloat(el.value) || 0;
      });

      const fat      = getFaturamento(mesKey);
      const fatTotal = getFaturamentoTotal(mesKey);
      const juros    = getJuros(mesKey);
      const tarifas  = getTarifas(mesKey);
      const ebitda   = getEbitda(mesKey);
      const dirDados = await getDiretoriaDados(mesIdx, ano);
      const reajuste = dirDados?.dados?.reajuste || 0;

      const metaJurosPerc   = params['param_metaJuros'] / 100;
      const txComissaoJuros = params['param_txComissaoJuros'] / 100;
      const txRecorrencia   = params['param_txRecorrencia'] / 100;
      const limTarifas      = params['param_limTarifas'] / 100;
      const txBancaria      = params['param_txEficiencia'] / 100;
      const txEbitdaMensal  = params['param_txEbitdaMensal'] / 100;
      const txBonusTrim     = params['param_txBonusTrim'] / 100;
      const metaEbitdaPerc  = params['metaEbitda_'+mesKey] / 100;

      const jurosPerc    = fat > 0 ? juros / fat : 0;
      const jurosOk      = jurosPerc >= metaJurosPerc;
      const comissaoJuros = jurosOk ? juros * txComissaoJuros : 0;
      const comissaoRec  = reajuste * txRecorrencia;
      const tarifasPerc  = fat > 0 ? tarifas / fat : 0;
      const tarifasOk    = tarifasPerc <= limTarifas;
      const comissaoTar  = tarifasOk ? fat * txBancaria : 0;
      const ebitdaPerc   = fat > 0 ? ebitda / fat : 0;
      const ebitdaOk     = ebitdaPerc >= metaEbitdaPerc;
      const comissaoEbitda = ebitdaOk ? ebitda * txEbitdaMensal : 0;
      const totalMensal  = comissaoJuros + comissaoRec + comissaoTar + comissaoEbitda;

      const snapshot = {
        fechadoEm: new Date().toISOString(),
        mesIdx, ano, mesKey,
        params,
        dados: { fat, fatTotal, juros, tarifas, ebitda, reajuste },
        calculos: {
          jurosPerc, jurosOk, comissaoJuros,
          comissaoRec,
          tarifasPerc, tarifasOk, comissaoTar,
          ebitdaPerc, ebitdaOk, comissaoEbitda,
          totalMensal
        }
      };

      const key = `mes_fechado_${ano}_${String(mesIdx+1).padStart(2,'0')}`;
      await sbStorage.set(key, JSON.stringify(snapshot));

      alert(`‚úÖ ${mesNome}/${ano} fechado com sucesso!\nDados congelados em ${new Date().toLocaleString('pt-BR')}.`);
      renderComissao();
    }

    async function reabrirMes() {
      const mesIdx = parseInt(document.getElementById('comissaoMesFiltro')?.value ?? 0);
      const ano    = document.getElementById('comissaoAnoFiltro')?.value ?? '2026';
      const mesNome = MESES_NOME[mesIdx];
      const conf = confirm(`Reabrir ${mesNome}/${ano}?\nOs c√°lculos voltar√£o a usar os par√¢metros atuais.`);
      if (!conf) return;
      const key = `mes_fechado_${ano}_${String(mesIdx+1).padStart(2,'0')}`;
      await sbStorage.remove(key);
      renderComissao();
    }

    async function getMesFechado(mesIdx, ano) {
      const key = `mes_fechado_${ano}_${String(mesIdx+1).padStart(2,'0')}`;
      try {
        const raw = await sbStorage.get(key);
        return raw ? JSON.parse(raw) : null;
      } catch(e) { return null; }
    }
    // =====================================================

    // Renderiza a view de comiss√£o a partir de um snapshot congelado
    function renderComissaoComDados(mesIdx, ano, mesKey, mesNome, dados, params, calc, fechadoEm) {
      const { fat, fatTotal, juros, tarifas, ebitda, reajuste } = dados;
      const { jurosPerc, jurosOk, comissaoJuros, comissaoRec,
              tarifasPerc, tarifasOk, comissaoTar,
              ebitdaPerc, ebitdaOk, comissaoEbitda, totalMensal } = calc;

      const txComissaoJuros = params['param_txComissaoJuros'] / 100;
      const txRecorrencia   = params['param_txRecorrencia'] / 100;
      const limTarifas      = params['param_limTarifas'] / 100;
      const txBancaria      = params['param_txEficiencia'] / 100;
      const txEbitdaMensal  = params['param_txEbitdaMensal'] / 100;
      const txBonusTrim     = params['param_txBonusTrim'] / 100;
      const metaJurosPerc   = params['param_metaJuros'] / 100;
      const metaEbitdaPerc  = params['metaEbitda_'+mesKey] / 100 || 0;
      const metaTrimQ1 = params['metaTrim_q1'] || 0;
      const metaTrimQ2 = params['metaTrim_q2'] || 0;
      const metaTrimQ3 = params['metaTrim_q3'] || 0;
      const metaTrimQ4 = params['metaTrim_q4'] || 0;

      const dtFechado = fechadoEm ? new Date(fechadoEm).toLocaleString('pt-BR') : '';
      const isFechado = !!fechadoEm;

      // Atualiza label do m√™s no t√≠tulo da matriz: cadeado se fechado
      const lbl = document.getElementById('comissaoMesLabel');
      if (lbl) {
        if (isFechado) {
          lbl.innerHTML = `üîí ${mesNome}/${ano} <span style="font-size:0.7rem;font-weight:500;opacity:0.8">fechado em ${dtFechado}</span>`;
          lbl.style.background = '#fef3c7';
          lbl.style.color = '#92400e';
        } else {
          lbl.textContent = `${mesNome}/${ano}`;
          lbl.style.background = '#dbeafe';
          lbl.style.color = '#1e40af';
        }
      }

      const aviso = document.getElementById('comissaoAvisoDiretoria');
      if (aviso) aviso.style.display = reajuste > 0 ? 'none' : 'block';

      const cards = [
        { icon:'üí∞', label:'Faturamento Base',   val: fatTotal,  cor:'#2563eb', sub:'Total Receitas (Consolidado)' },
        { icon:'üìã', label:'Juros/Multa',         val: juros,     cor:'#10b981', sub:'Receita de juros' },
        { icon:'üè¶', label:'Tarifas Banc√°rias',   val: tarifas,   cor:'#f59e0b', sub:'Despesa banc√°ria' },
        { icon:'üîµ', label:'Reajuste Contratual', val: reajuste,  cor:'#8b5cf6', sub:'Fonte: PDF Diretoria' },
        { icon:'üìä', label:'EBITDA (Ajustado)',   val: ebitda,    cor:'#059669', sub:'EBITDA c/ ajustes' },
      ];
      const cardsEl = document.getElementById('comissaoCardsResumo');
      if (cardsEl) cardsEl.innerHTML = cards.map(c => `
        <div style="background:white;border-radius:14px;box-shadow:0 2px 12px rgba(0,0,0,0.08);padding:1.25rem;border-top:4px solid ${c.cor}">
          <div style="font-size:0.78rem;color:#64748b;font-weight:500;margin-bottom:0.75rem">${c.icon} ${c.label}</div>
          <div style="font-size:1.4rem;font-weight:800;color:${c.val<0?'#b91c1c':c.cor}">${c.val!==0?formatCurrency(c.val):'<span style="color:#cbd5e1;font-size:1rem">Sem dados</span>'}</div>
          <div style="font-size:0.72rem;color:#94a3b8;margin-top:0.35rem">${c.sub} ¬∑ ${mesNome}/${ano}</div>
        </div>`).join('');

      const pct = v => {
        const n = v * 100;
        if (n === 0) return '0%';
        if (Math.abs(n) < 0.01) return n.toFixed(4) + '%';
        if (Math.abs(n) < 0.1)  return n.toFixed(3) + '%';
        if (Math.abs(n) < 1)    return n.toFixed(3) + '%';
        return n.toFixed(2) + '%';
      };
      const tip = (txt) => `<span style="display:inline-flex;align-items:center;justify-content:center;width:15px;height:15px;background:#e2e8f0;border-radius:50%;font-size:0.65rem;color:#475569;cursor:help;margin-left:4px;vertical-align:middle;font-style:normal" title="${txt}">?</span>`;

      const matrizEl = document.getElementById('comissaoMatriz');
      if (matrizEl) matrizEl.innerHTML =
        indicadorRow('üìã','Juros / Comiss√£o',
          `Juros: <b>${formatCurrency(juros)}</b> | Juros/Fat: <b>${pct(jurosPerc)}</b>${tip('Juros √∑ Faturamento Base')} | Meta m√≠n.: <b>${pct(metaJurosPerc)}</b> | Taxa: <b>${pct(txComissaoJuros)}</b>`,
          badgeStatus(jurosOk,'Meta atingida','Abaixo da meta'), comissaoJuros)
        + indicadorRow('üîµ','Reajuste Contratual',
          `Reajuste: <b>${reajuste ? formatCurrency(reajuste) : 'Sem dados PDF'}</b> | Taxa Recorr√™ncia: <b>${pct(txRecorrencia)}</b>`,
          reajuste > 0 ? badgeStatus(true,'PDF carregado','') : `<span style="background:#fef3c7;color:#92400e;padding:0.25rem 0.75rem;border-radius:20px;font-size:0.78rem;font-weight:700">‚ö†Ô∏è PDF n√£o carregado</span>`,
          comissaoRec)
        + indicadorRow('üè¶','Efici√™ncia Banc√°ria (Tarifas)',
          `Tarifas: <b>${formatCurrency(tarifas)}</b> | Tarifas/Fat: <b>${pct(tarifasPerc)}</b> | Limite m√°x.: <b>${pct(limTarifas)}</b> | Taxa: <b>${pct(txBancaria)}</b>`,
          badgeStatus(tarifasOk,'Eficiente','Acima do limite'), comissaoTar)
        + indicadorRow('üìä','EBITDA Mensal',
          `EBITDA: <b>${formatCurrency(ebitda)}</b> | EBITDA%: <b>${pct(ebitdaPerc)}</b> | Meta: <b>${pct(metaEbitdaPerc)}</b> | Taxa: <b>${pct(txEbitdaMensal)}</b>`,
          badgeStatus(ebitdaOk,'Meta atingida','Abaixo da meta'), comissaoEbitda)
        + `<div style="display:grid;grid-template-columns:1fr auto auto;align-items:center;gap:1rem;padding:1rem 1.25rem;background:linear-gradient(135deg,#1e3a8a,#2563eb);border-radius:12px;color:white;margin-top:0.5rem">
            <div style="font-weight:700;font-size:1rem">üíº Total Mensal ‚Äî ${mesNome}/${ano}</div>
            <div style="font-size:1.4rem;font-weight:800">${formatCurrency(totalMensal)}</div>
            ${isFechado
              ? `<button onclick="reabrirMes()" title="Reabrir m√™s para edi√ß√£o" style="padding:0.45rem 1rem;background:rgba(255,255,255,0.15);border:2px solid rgba(255,255,255,0.5);color:white;border-radius:8px;cursor:pointer;font-weight:700;font-size:0.82rem;white-space:nowrap">üîì Reabrir</button>`
              : `<button onclick="fecharMes()" title="Congelar dados deste m√™s" style="padding:0.45rem 1rem;background:#dc2626;border:none;color:white;border-radius:8px;cursor:pointer;font-weight:700;font-size:0.82rem;white-space:nowrap">üîí Fechar M√™s</button>`
            }
          </div>`;

      const trim = [
        { nome:'Q1 (Jan-Mar)', meses:['jan','fev','mar'], meta: metaTrimQ1 },
        { nome:'Q2 (Abr-Jun)', meses:['abr','mai','jun'], meta: metaTrimQ2 },
        { nome:'Q3 (Jul-Set)', meses:['jul','ago','set'], meta: metaTrimQ3 },
        { nome:'Q4 (Out-Dez)', meses:['out','nov','dez'], meta: metaTrimQ4 },
      ];
      const bonusEl = document.getElementById('comissaoBonusTrim');
      if (bonusEl) {
        bonusEl.innerHTML = trim.map((q, qi) => {
          const ebitdaAcum = q.meses.reduce((s, m) => s + getEbitda(m), 0);
          const trimOk     = q.meta > 0 && ebitdaAcum >= q.meta;
          const bonus      = trimOk ? ebitdaAcum * txBonusTrim : 0;
          const progresso  = q.meta > 0 ? Math.min(100, (ebitdaAcum / q.meta) * 100) : 0;
          const corProg    = trimOk ? '#059669' : progresso > 60 ? '#f59e0b' : '#e2e8f0';
          const temDados   = ebitdaAcum > 0;
          return `<div style="border:1px solid #e2e8f0;border-radius:14px;padding:1.25rem;${trimOk?'border-color:#86efac;background:#f0fdf4;':''}">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1rem">
              <div style="font-weight:700;color:#1e293b;font-size:0.9rem">${q.nome}</div>
              ${trimOk ? '<span style="background:#dcfce7;color:#166534;padding:0.2rem 0.6rem;border-radius:20px;font-size:0.75rem;font-weight:700">‚úì Atingido</span>'
                        : q.meta===0 ? '<span style="background:#f1f5f9;color:#94a3b8;padding:0.2rem 0.6rem;border-radius:20px;font-size:0.75rem">Sem meta</span>'
                        : '<span style="background:#fef3c7;color:#92400e;padding:0.2rem 0.6rem;border-radius:20px;font-size:0.75rem;font-weight:700">Em andamento</span>'}
            </div>
            <div style="margin-bottom:0.6rem">
              <div style="display:flex;justify-content:space-between;font-size:0.78rem;color:#64748b;margin-bottom:0.3rem"><span>EBITDA Acumulado</span><span style="font-weight:700;color:#1e293b">${temDados ? formatCurrency(ebitdaAcum) : '‚Äî'}</span></div>
              <div style="display:flex;justify-content:space-between;font-size:0.78rem;color:#64748b;margin-bottom:0.6rem"><span>Meta</span><span style="font-weight:700;color:#1e293b">${q.meta>0 ? formatCurrency(q.meta) : 'N√£o definida'}</span></div>
              ${q.meta>0 ? `<div style="background:#e2e8f0;border-radius:99px;height:8px;overflow:hidden"><div style="background:${corProg};height:100%;width:${progresso.toFixed(1)}%;transition:width 0.5s;border-radius:99px"></div></div><div style="font-size:0.72rem;color:#94a3b8;margin-top:0.25rem;text-align:right">${progresso.toFixed(1)}% da meta</div>` : ''}
            </div>
            <div style="border-top:1px solid #e2e8f0;padding-top:0.75rem;display:flex;justify-content:space-between;align-items:center">
              <span style="font-size:0.78rem;color:#64748b">B√¥nus (${(txBonusTrim*100).toFixed(2)}%)</span>
              <span style="font-size:1.1rem;font-weight:800;color:${bonus>0?'#059669':'#94a3b8'}">${bonus>0?formatCurrency(bonus):'‚Äî'}</span>
            </div>
          </div>`;
        }).join('');
      }

      const trimAtual = Math.floor(mesIdx / 3);
      const metasTrim = [metaTrimQ1, metaTrimQ2, metaTrimQ3, metaTrimQ4];
      const ebitdaAcumTrimAtual = trim[trimAtual].meses.reduce((s,m)=>s+getEbitda(m),0);
      const bonusTrimAtual = metasTrim[trimAtual]>0 && ebitdaAcumTrimAtual>=metasTrim[trimAtual] ? ebitdaAcumTrimAtual * txBonusTrim : 0;
      const totalGeral = totalMensal + bonusTrimAtual;
      const totalEl = document.getElementById('comissaoTotalGeral');
      if (totalEl) totalEl.innerHTML = `
        <div style="background:linear-gradient(135deg,#059669,#047857);border-radius:16px;padding:2rem;color:white">
          <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1.5rem;align-items:center">
            <div><div style="font-size:0.85rem;opacity:0.85;margin-bottom:0.25rem">üíº Total Mensal</div><div style="font-size:1.6rem;font-weight:800">${formatCurrency(totalMensal)}</div><div style="font-size:0.75rem;opacity:0.75;margin-top:0.25rem">${mesNome}/${ano}</div></div>
            <div><div style="font-size:0.85rem;opacity:0.85;margin-bottom:0.25rem">üèÜ B√¥nus Trimestral Q${trimAtual+1}</div><div style="font-size:1.6rem;font-weight:800">${bonusTrimAtual>0?formatCurrency(bonusTrimAtual):'‚Äî'}</div><div style="font-size:0.75rem;opacity:0.75;margin-top:0.25rem">${bonusTrimAtual>0?'Meta atingida':'Em andamento'}</div></div>
            <div style="background:rgba(255,255,255,0.15);border-radius:12px;padding:1.25rem;text-align:center"><div style="font-size:0.85rem;opacity:0.85;margin-bottom:0.5rem">üéØ TOTAL GERAL</div><div style="font-size:2rem;font-weight:900">${formatCurrency(totalGeral)}</div><div style="font-size:0.75rem;opacity:0.75;margin-top:0.25rem">Mensal + B√¥nus Q${trimAtual+1}</div></div>
          </div>
        </div>`;
    }

    async function renderComissao() {
      const mesIdx  = parseInt(document.getElementById('comissaoMesFiltro')?.value ?? 0);
      const ano     = document.getElementById('comissaoAnoFiltro')?.value ?? '2026';
      const mesKey  = MESES_KEY[mesIdx];
      const mesNome = MESES_NOME[mesIdx];

      // Atualiza label
      const lbl = document.getElementById('comissaoMesLabel');
      if (lbl) lbl.textContent = `${mesNome}/${ano}`;

      // Verifica se m√™s est√° fechado
      const frozen = await getMesFechado(mesIdx, ano);

      if (frozen) {
        // Usa dados congelados do Supabase
        renderComissaoComDados(mesIdx, ano, mesKey, mesNome, frozen.dados, frozen.params, frozen.calculos, frozen.fechadoEm);
        return;
      }

      // === PAR√ÇMETROS AO VIVO ===
      const metaJurosPerc    = getParam('param_metaJuros', 1.90) / 100;       // 1.9%
      const txComissaoJuros  = getParam('param_txComissaoJuros', 1.10) / 100; // 1.1%
      const txRecorrencia    = getParam('param_txRecorrencia', 14) / 100;      // 14%
      const limTarifas       = getParam('param_limTarifas', 0.38) / 100;      // 0.38%
      const txBancaria       = getParam('param_txEficiencia', 0.015) / 100;   // 0.015%
      const txEbitdaMensal   = getParam('param_txEbitdaMensal', 0.10) / 100;  // 0.1%
      const txBonusTrim      = getParam('param_txBonusTrim', 0.20) / 100;     // 0.2%
      const metaEbitdaPerc   = getParam('metaEbitda_'+mesKey, 0) / 100;
      const metaTrimQ1       = getParam('metaTrim_q1', 0);
      const metaTrimQ2       = getParam('metaTrim_q2', 0);
      const metaTrimQ3       = getParam('metaTrim_q3', 0);
      const metaTrimQ4       = getParam('metaTrim_q4', 0);

      // === DADOS DO M√äS ===
      const fat      = getFaturamento(mesKey);       // PF+PJ apenas (para c√°lculos de comiss√£o)
      const fatTotal = getFaturamentoTotal(mesKey);   // todas receitas (para exibi√ß√£o nos cards)
      const juros    = getJuros(mesKey);
      const tarifas  = getTarifas(mesKey);
      const ebitda   = getEbitda(mesKey);

      // Diretoria (PDF Supabase)
      const dirDados = await getDiretoriaDados(mesIdx, ano);
      const hasDiretoria = !!(dirDados && dirDados.dados);
      const resultadoLiq = hasDiretoria ? (dirDados.dados.resultado || 0) : 0;
      const reajuste     = hasDiretoria ? (dirDados.dados.reajuste || 0)  : 0;

      // Aviso diretoria
      const aviso = document.getElementById('comissaoAvisoDiretoria');
      if (aviso) aviso.style.display = hasDiretoria ? 'none' : 'block';

      // Monta params e calculos no mesmo formato do snapshot para reusar renderComissaoComDados
      const params = {
        'param_metaJuros': metaJurosPerc * 100, 'param_txComissaoJuros': txComissaoJuros * 100,
        'param_txRecorrencia': txRecorrencia * 100, 'param_limTarifas': limTarifas * 100,
        'param_txEficiencia': txBancaria * 100, 'param_txEbitdaMensal': txEbitdaMensal * 100,
        'param_txBonusTrim': txBonusTrim * 100, ['metaEbitda_'+mesKey]: metaEbitdaPerc * 100,
        'metaTrim_q1': metaTrimQ1, 'metaTrim_q2': metaTrimQ2,
        'metaTrim_q3': metaTrimQ3, 'metaTrim_q4': metaTrimQ4,
      };

      const jurosPerc    = fat > 0 ? juros / fat : 0;
      const jurosOk      = jurosPerc >= metaJurosPerc;
      const comissaoJuros = jurosOk ? juros * txComissaoJuros : 0;
      const comissaoRec  = reajuste * txRecorrencia;
      const tarifasPerc  = fat > 0 ? tarifas / fat : 0;
      const tarifasOk    = tarifasPerc <= limTarifas;
      const comissaoTar  = tarifasOk ? fat * txBancaria : 0;
      const ebitdaPerc   = fat > 0 ? ebitda / fat : 0;
      const ebitdaOk     = ebitdaPerc >= metaEbitdaPerc;
      const comissaoEbitda = ebitdaOk ? ebitda * txEbitdaMensal : 0;
      const totalMensal  = comissaoJuros + comissaoRec + comissaoTar + comissaoEbitda;

      const calculos = { jurosPerc, jurosOk, comissaoJuros, comissaoRec,
                         tarifasPerc, tarifasOk, comissaoTar,
                         ebitdaPerc, ebitdaOk, comissaoEbitda, totalMensal };

      renderComissaoComDados(mesIdx, ano, mesKey, mesNome,
        { fat, fatTotal, juros, tarifas, ebitda, reajuste },
        params, calculos, null);
    }


    async function salvarParams() {
      const ids = [
        'param_metaJuros','param_txComissaoJuros','param_txRecorrencia',
        'param_limTarifas','param_txEficiencia','param_txEbitdaMensal','param_txBonusTrim',
        'metaEbitda_jan','metaEbitda_fev','metaEbitda_mar','metaEbitda_abr',
        'metaEbitda_mai','metaEbitda_jun','metaEbitda_jul','metaEbitda_ago',
        'metaEbitda_set','metaEbitda_out','metaEbitda_nov','metaEbitda_dez',
        'metaTrim_q1','metaTrim_q2','metaTrim_q3','metaTrim_q4'
      ];
      const params = {};
      ids.forEach(id => {
        const el = document.getElementById(id);
        if (el) params[id] = el.value;
      });
      await sbStorage.set('app_params', JSON.stringify(params));
      const msg = document.getElementById('paramSalvoMsg');
      if (msg) { msg.style.display='block'; setTimeout(()=>msg.style.display='none', 3000); }
    }

    async function carregarParams() {
      try {
        const raw = await sbStorage.get('app_params');
        if (!raw) return;
        const params = JSON.parse(raw);
        Object.entries(params).forEach(([id, val]) => {
          const el = document.getElementById(id);
          if (el) el.value = val;
        });
        console.log('‚úÖ Par√¢metros carregados do Supabase');
      } catch(e) { console.warn('carregarParams falhou:', e); }
    }


    // ==================== CONSOLIDADO CSV SYNC ====================
    const ONEDRIVE_CSV_URL = 'https://excel.officeapps.live.com/x/_layouts/XlFileHandler.aspx?sheetName=JAN%202026&downloadAsCsvEnabled=1&WacUserType=WOPI&usid=81107527-d1ec-8889-b800-a4c8b76fe6e5&NoAuth=1&waccluster=PBR1';

    // Mapeamento: nome no CSV ‚Üí chave em dadosFinanceiros + categoria
    const CSV_MAP = {
      // RECEITAS
      'link pessoa f√≠sica':        { cat:'receitas', nome:'Link Pessoa F√≠sica' },
      'link pf':                   { cat:'receitas', nome:'Link Pessoa F√≠sica' },
      'link pessoa jur√≠dica':      { cat:'receitas', nome:'Link Pessoa Jur√≠dica' },
      'link pj':                   { cat:'receitas', nome:'Link Pessoa Jur√≠dica' },
      'juros/multa':               { cat:'receitas', nome:'Juros/Multa' },
      'juros':                     { cat:'receitas', nome:'Juros/Multa' },
      'taxa de instala√ß√£o':        { cat:'receitas', nome:'Taxa de instala√ß√£o' },
      'eventos':                   { cat:'receitas', nome:'Eventos' },
      'multa fidelidade':          { cat:'receitas', nome:'Multa fidelidade e equipamento' },
      'multa fidelidade e equipamento': { cat:'receitas', nome:'Multa fidelidade e equipamento' },
      'rendimentos financeiros':   { cat:'receitas', nome:'Rendimentos financeiros' },
      'vendas canceladas':         { cat:'receitas', nome:'Vendas canceladas e estornos' },
      'vendas canceladas e estornos': { cat:'receitas', nome:'Vendas canceladas e estornos' },
      // IMPOSTOS
      'icms':                      { cat:'impostos', nome:'ICMS' },
      'cofins':                    { cat:'impostos', nome:'COFINS' },
      'pis':                       { cat:'impostos', nome:'PIS' },
      'irpj':                      { cat:'impostos', nome:'IRPJ' },
      'csll':                      { cat:'impostos', nome:'CSLL' },
      'iss':                       { cat:'impostos', nome:'ISS' },
      'fust/funttel':              { cat:'impostos', nome:'FUST/FUNTTEL' },
      'fust':                      { cat:'impostos', nome:'FUST/FUNTTEL' },
      // CUSTOS
      'kit instala√ß√£o':            { cat:'custos', nome:'Kit Instala√ß√£o' },
      'materiais de rede':         { cat:'custos', nome:'Materiais de Rede' },
      'links de dados':            { cat:'custos', nome:'Links de Dados / Voip' },
      'links de dados / voip':     { cat:'custos', nome:'Links de Dados / Voip' },
      'vtal':                      { cat:'custos', nome:'Vtal' },
      'alugueis de postes':        { cat:'custos', nome:'Alugueis de Postes' },
      'alugueis de torre':         { cat:'custos', nome:'Alugueis de Torre e POP' },
      'alugueis de torre e pop':   { cat:'custos', nome:'Alugueis de Torre e POP' },
      'custo com sva':             { cat:'custos', nome:'Custo com SVA' },
      'energia / pop':             { cat:'custos', nome:'Energia / POP' },
      'comiss√µes de vendas':       { cat:'custos', nome:'Comiss√µes de vendas' },
      'combust√≠vel t√©cnico':       { cat:'custos', nome:'Combust√≠vel t√©cnico' },
      'manut. ve√≠culo':            { cat:'custos', nome:'Manut. Ve√≠culo' },
      'manuten√ß√£o ve√≠culo':        { cat:'custos', nome:'Manut. Ve√≠culo' },
      'folha - direta':            { cat:'custos', nome:'Folha - Direta' },
      'folha direta':              { cat:'custos', nome:'Folha - Direta' },
      'telefonia':                 { cat:'custos', nome:'Telefonia' },
      'ferramentas':               { cat:'custos', nome:'Ferramentas' },
      'custos lastmile':           { cat:'custos', nome:'Custos Lastmile' },
      // DESPESAS
      'marketing':                 { cat:'despesas', nome:'Marketing' },
      'serv. terceiros':           { cat:'despesas', nome:'Serv. Terceiros, jur√≠dicos e consultorias' },
      'servi√ßos terceiros':        { cat:'despesas', nome:'Serv. Terceiros, jur√≠dicos e consultorias' },
      'aluguel de escrit√≥rio':     { cat:'despesas', nome:'Desp. Aluguel de escrit√≥rio' },
      'desp. aluguel':             { cat:'despesas', nome:'Desp. Aluguel de escrit√≥rio' },
      'pr√≥-labore':                { cat:'despesas', nome:'Pr√≥-Labore' },
      'pro-labore':                { cat:'despesas', nome:'Pr√≥-Labore' },
      'sistema':                   { cat:'despesas', nome:'Sistema' },
      'taxas boleto':              { cat:'despesas', nome:'Taxas Boleto' },
      'tarifas banc√°rias':         { cat:'despesas', nome:'Tarifas banc√°rias' },
      'tarifas bancarias':         { cat:'despesas', nome:'Tarifas banc√°rias' },
      // EBITDA
      'ebitda':                    { cat:'ebitda', nome:'EBITDA' },
      // EBITDA AJUSTADO
      'irpj (previs√£o)':           { cat:'ebitda_ajustado', nome:'IRPJ (Previs√£o)' },
      'cssl (previs√£o)':           { cat:'ebitda_ajustado', nome:'CSSL (Previs√£o)' },
      'trimestral':                { cat:'ebitda_ajustado', nome:'Trimestral' },
      'compra de provedor':        { cat:'ebitda_ajustado', nome:'Compra de Provedor' },
      'ajuste (postes)':           { cat:'ebitda_ajustado', nome:'Ajuste (Postes)' },
      'ajuste vtal':               { cat:'ebitda_ajustado', nome:'Ajuste Vtal Fora' },
      'ebitda (ajustado)':         { cat:'ebitda_ajustado', nome:'EBITDA (Ajustado)' },
      // AJUSTES DE CAIXA
      'investimento':              { cat:'ajustes', nome:'Investimento' },
      'empr/finac/parcel':         { cat:'ajustes', nome:'Empr/Finac/Parcel' },
      'impostos':                  { cat:'ajustes', nome:'Impostos' },
      's√≥cios ou retiradas':       { cat:'ajustes', nome:'S√≥cios ou Retiradas' },
      'retiradas':                 { cat:'ajustes', nome:'S√≥cios ou Retiradas' },
      // BANCOS
      'mg - ita√∫':                 { cat:'bancos', nome:'MG - Ita√∫' },
      'speed - ita√∫':              { cat:'bancos', nome:'Speed - Ita√∫ + Vinc.' },
      'caixa tesouraria':          { cat:'bancos', nome:'Caixa Tesouraria' },
    };

    const MESES_CSV_KEY = { 'jan':0,'fev':1,'mar':2,'abr':3,'mai':4,'jun':5,'jul':6,'ago':7,'set':8,'out':9,'nov':10,'dez':11,
      'janeiro':0,'fevereiro':1,'mar√ßo':2,'abril':3,'maio':4,'junho':5,'julho':6,'agosto':7,'setembro':8,'outubro':9,'novembro':10,'dezembro':11 };

    function syncSetStatus(msg, tipo) {
      const el = document.getElementById('syncStatusMsg');
      if (!el) return;
      const cor = tipo==='ok' ? '#059669' : tipo==='erro' ? '#b91c1c' : tipo==='warn' ? '#b45309' : '#64748b';
      el.innerHTML = `<span style="color:${cor}">${msg}</span>`;
    }
    function syncSetProgress(pct, msg) {
      const bar  = document.getElementById('syncProgressBar');
      const fill = document.getElementById('syncProgressFill');
      const txt  = document.getElementById('syncProgressMsg');
      if (!bar) return;
      if (pct === null) { bar.style.display='none'; return; }
      bar.style.display = 'block';
      fill.style.width  = pct + '%';
      txt.textContent   = msg || '';
    }

    // Sync date ‚Äî mantido em localStorage por performance (n√£o precisa persistir entre dispositivos)
    function syncJaFezHoje() {
      const ultima = localStorage.getItem('consolidado_sync_data');
      return ultima === new Date().toISOString().slice(0,10);
    }
    function syncMarcarFeito() {
      localStorage.setItem('consolidado_sync_data', new Date().toISOString().slice(0,10));
    }

    async function syncAtualizarStatusUI() {
      const raw = await sbStorage.get('consolidado_dados');
      const ultima = localStorage.getItem('consolidado_sync_data');
      if (raw) {
        const hoje = new Date().toISOString().slice(0,10);
        if (ultima === hoje) {
          syncSetStatus(`‚úÖ Dados sincronizados hoje (${new Date().toLocaleDateString('pt-BR')})`, 'ok');
        } else {
          syncSetStatus(`‚ö†Ô∏è √öltima atualiza√ß√£o: ${ultima ? new Date(ultima+'T12:00:00').toLocaleDateString('pt-BR') : 'desconhecida'} ‚Äî fa√ßa upload para atualizar`, 'warn');
        }
      } else {
        syncSetStatus('‚ö° Nenhum dado importado ainda. Fa√ßa upload do XLSX.', 'info');
      }
    }

    // Tenta buscar CSV do OneDrive automaticamente
    async function consolidadoAutoFetch() {
      const btn = document.getElementById('btnAutoFetch');
      if (btn) { btn.disabled=true; btn.textContent='‚è≥ Buscando...'; }
      syncSetProgress(10, 'Conectando ao OneDrive...');
      syncSetStatus('Buscando dados do OneDrive...', 'info');
      try {
        const resp = await fetch(ONEDRIVE_CSV_URL, { mode:'cors' });
        if (!resp.ok) throw new Error('HTTP ' + resp.status);
        const text = await resp.text();
        if (!text || text.trim().length < 10) throw new Error('Resposta vazia');
        syncSetProgress(50, 'Dados recebidos, processando CSV...');
        await consolidadoProcessarCsv(text, 'OneDrive');
      } catch(e) {
        syncSetProgress(null);
        syncSetStatus(`‚ùå N√£o foi poss√≠vel buscar automaticamente (${e.message}). Use o upload manual.`, 'erro');
        // Destaca o bot√£o de upload
        const label = document.querySelector('label[for="consolidadoCsvInput"], label:has(#consolidadoCsvInput)');
        if (label) label.style.background = '#fef3c7';
      }
      if (btn) { btn.disabled=false; btn.textContent='‚òÅÔ∏è Buscar do OneDrive'; }
    }

    async function consolidadoParseXlsx(input) {
      const file = input.files[0];
      if (!file) return;
      syncSetProgress(10, 'Lendo arquivo XLSX...');
      syncSetStatus('Lendo arquivo...', 'info');
      const reader = new FileReader();
      reader.onload = async e => {
        try {
          const data = new Uint8Array(e.target.result);
          const wb = XLSX.read(data, { type: 'array' });

          // Usa aba "Anual Real - 2026" que tem todos os meses como colunas
          const sheetName = wb.SheetNames.find(s => s.toLowerCase().includes('anual real')) || wb.SheetNames[0];
          syncSetProgress(30, `Lendo aba: ${sheetName}`);
          const ws = wb.Sheets[sheetName];
          const rows = XLSX.utils.sheet_to_json(ws, { header: 1, defval: 0 });

          // Detecta linha de header (com nomes de meses)
          const MESES_ABREV = ['jan','fev','mar','abr','mai','jun','jul','ago','set','out','nov','dez'];
          let headerIdx = -1;
          let colMeses = {}; // mesKey ‚Üí colIndex

          for (let i = 0; i < Math.min(10, rows.length); i++) {
            rows[i].forEach((cel, ci) => {
              if (typeof cel === 'string') {
                const c = cel.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim().slice(0,3);
                if (MESES_ABREV.includes(c)) {
                  colMeses[c] = ci;
                  headerIdx = i;
                }
              }
            });
            if (Object.keys(colMeses).length >= 2) break;
          }

          if (headerIdx < 0) {
            syncSetStatus('‚ùå N√£o encontrei colunas de meses. Use a aba "Anual Real - 2026".', 'erro');
            syncSetProgress(null);
            return;
          }

          syncSetProgress(50, `Meses detectados: ${Object.keys(colMeses).join(', ')}`);

          // Mapeamento: nome da linha (col A) ‚Üí categoria + nome no sistema
          const ROW_MAP = {
            'link pessoa f√≠sica':                        { cat:'receitas', nome:'Link Pessoa F√≠sica' },
            'link pessoa juridica':                      { cat:'receitas', nome:'Link Pessoa Jur√≠dica' },
            'juros/multa':                               { cat:'receitas', nome:'Juros/Multa' },
            'taxa de instalacao':                        { cat:'receitas', nome:'Taxa de instala√ß√£o' },
            'eventos':                                   { cat:'receitas', nome:'Eventos' },
            'multa fidelidade e equipamento':            { cat:'receitas', nome:'Multa fidelidade e equipamento' },
            'rendimentos financeiros':                   { cat:'receitas', nome:'Rendimentos financeiros' },
            'vendas canceladas e estornos':              { cat:'receitas', nome:'Vendas canceladas e estornos' },
            'icms':                                      { cat:'impostos', nome:'ICMS' },
            'cofins':                                    { cat:'impostos', nome:'COFINS' },
            'pis':                                       { cat:'impostos', nome:'PIS' },
            'irpj':                                      { cat:'impostos', nome:'IRPJ' },
            'csll':                                      { cat:'impostos', nome:'CSLL' },
            'iss':                                       { cat:'impostos', nome:'ISS' },
            'fust/funttel':                              { cat:'impostos', nome:'FUST/FUNTTEL' },
            'kit instalacao':                            { cat:'custos', nome:'Kit Instala√ß√£o' },
            'materiais de rede':                         { cat:'custos', nome:'Materiais de Rede' },
            'links de dados / voip':                     { cat:'custos', nome:'Links de Dados / Voip' },
            'vtal':                                      { cat:'custos', nome:'Vtal' },
            'alugueis de postes':                        { cat:'custos', nome:'Alugueis de Postes' },
            'alugueis de torre e pop':                   { cat:'custos', nome:'Alugueis de Torre e POP' },
            'custo com sva':                             { cat:'custos', nome:'Custo com SVA' },
            'energia / pop':                             { cat:'custos', nome:'Energia / POP' },
            'comissoes de vendas':                       { cat:'custos', nome:'Comiss√µes de vendas' },
            'combustivel tecnico':                       { cat:'custos', nome:'Combust√≠vel t√©cnico' },
            'manut. veiculo':                            { cat:'custos', nome:'Manut. Ve√≠culo' },
            'folha - direta':                            { cat:'custos', nome:'Folha - Direta' },
            'telefonia':                                 { cat:'custos', nome:'Telefonia' },
            'ferramentas':                               { cat:'custos', nome:'Ferramentas' },
            'custos lastmile':                           { cat:'custos', nome:'Custos Lastmile' },
            'marketing':                                 { cat:'despesas', nome:'Marketing' },
            'serv. terceiros, juridicos e consultorias': { cat:'despesas', nome:'Serv. Terceiros, jur√≠dicos e consultorias' },
            'desp. aluguel de escritorio':               { cat:'despesas', nome:'Desp. Aluguel de escrit√≥rio' },
            'pro-labore':                                { cat:'despesas', nome:'Pr√≥-Labore' },
            'sistema':                                   { cat:'despesas', nome:'Sistema' },
            'taxas boleto':                              { cat:'despesas', nome:'Taxas Boleto' },
            'tarifas bancarias':                         { cat:'despesas', nome:'Tarifas banc√°rias' },
            'ebitda':                                    { cat:'ebitda', nome:'EBITDA' },
            'irpj (previsao)':                           { cat:'ebitda_ajustado', nome:'IRPJ (Previs√£o)' },
            'cssl (previsao)':                           { cat:'ebitda_ajustado', nome:'CSSL (Previs√£o)' },
            'trimestral':                                { cat:'ebitda_ajustado', nome:'Trimestral' },
            'compra de provedor':                        { cat:'ebitda_ajustado', nome:'Compra de Provedor' },
            'ajuste (postes)':                           { cat:'ebitda_ajustado', nome:'Ajuste (Postes)' },
            'ajuste vtal fora':                          { cat:'ebitda_ajustado', nome:'Ajuste Vtal Fora' },
            'ebitda (ajustado)':                         { cat:'ebitda_ajustado', nome:'EBITDA (Ajustado)' },
            'investimento':                              { cat:'ajustes', nome:'Investimento' },
            'empr/finac/parcel':                         { cat:'ajustes', nome:'Empr/Finac/Parcel' },
            'socios ou retiradas':                       { cat:'ajustes', nome:'S√≥cios ou Retiradas' },
          };

          // √çndice r√°pido dos itens do sistema
          const itemIdx = {};
          ['receitas','impostos','custos','despesas','ebitda','ebitda_ajustado','ajustes','bancos'].forEach(cat => {
            (dadosFinanceiros[cat]||[]).forEach(item => { itemIdx[item.nome] = item; });
          });

          let atualizados = 0;
          let ebitdaVisto = false; // controla pular a linha % do EBITDA (Ajustado) logo ap√≥s a linha de valores

          for (let i = headerIdx + 1; i < rows.length; i++) {
            const row = rows[i];
            const nomeRaw = typeof row[0] === 'string' ? row[0].trim() : '';
            if (!nomeRaw) continue;

            const nomeNorm = nomeRaw.toLowerCase()
              .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
              .replace(/\s+/g, ' ').trim();

            // Pula linha de % (EBITDA Ajustado %, Folha/Receita, etc.)
            if (typeof row[Object.values(colMeses)[0]] === 'number' &&
                Math.abs(row[Object.values(colMeses)[0]]) < 2 &&
                row[Object.values(colMeses)[0]] !== 0 &&
                nomeNorm !== 'vtal') continue;

            const mapped = ROW_MAP[nomeNorm];
            if (!mapped) continue;

            // Evita duplicar EBITDA (Ajustado) ‚Äî pega s√≥ a linha de valores, n√£o a de %
            if (mapped.nome === 'EBITDA (Ajustado)' && ebitdaVisto) continue;
            if (mapped.nome === 'EBITDA (Ajustado)') ebitdaVisto = true;

            const item = itemIdx[mapped.nome];
            if (!item) continue;

            MESES_ABREV.forEach(m => {
              const ci = colMeses[m];
              if (ci === undefined) return;
              const v = row[ci];
              item[m] = typeof v === 'number' ? Math.round(v * 100) / 100 : 0;
            });
            item.total = MESES_ABREV.reduce((s, m) => s + (item[m] || 0), 0);
            item.total = Math.round(item.total * 100) / 100;
            atualizados++;
          }

          syncSetProgress(90, 'Salvando no Supabase...');
          await sbStorage.set('consolidado_dados', JSON.stringify(dadosFinanceiros));
          await sbStorage.set('consolidado_versao', DADOS_VERSION);
          syncMarcarFeito();
          showTab(document.querySelector('.tab-btn.active')?.textContent?.toLowerCase().trim() || 'receitas');
          renderComissao();
          syncSetProgress(null);
          input.value = '';

          syncSetStatus(
            atualizados > 0
              ? `‚úÖ ${atualizados} categorias importadas da aba "${sheetName}"`
              : `‚ö†Ô∏è Nenhuma categoria reconhecida. Verifique se enviou o arquivo correto.`,
            atualizados > 0 ? 'ok' : 'warn'
          );
        } catch(err) {
          syncSetProgress(null);
          syncSetStatus(`‚ùå Erro ao ler XLSX: ${err.message}`, 'erro');
          console.error(err);
        }
      };
      reader.readAsArrayBuffer(file);
      input.value = '';
    }

    // Parser principal do CSV ‚Äî vers√£o simples e robusta
    async function consolidadoProcessarCsv(csvText, fonte) {
      try {
        syncSetProgress(40, 'Detectando estrutura...');

        // Normaliza separador (v√≠rgula ou ponto-e-v√≠rgula)
        const linhas = csvText.split(/\r?\n/);
        const sep = linhas[0].includes(';') ? ';' : ',';
        const rows = linhas.map(l => l.split(sep).map(c => c.trim().replace(/^["']|["']$/g, '').trim()));

        // Detecta linha do header buscando meses
        const MESES_PT = ['jan','fev','mar','abr','mai','jun','jul','ago','set','out','nov','dez',
                          'janeiro','fevereiro','mar√ßo','marco','abril','maio','junho','julho',
                          'agosto','setembro','outubro','novembro','dezembro'];
        let headerIdx = -1;
        let colMeses = {}; // mesKey ‚Üí colIndex

        for (let i = 0; i < Math.min(15, rows.length); i++) {
          let achou = 0;
          rows[i].forEach((cel, ci) => {
            const c = cel.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').trim();
            const idx = MESES_PT.indexOf(c);
            if (idx >= 0) {
              const mesKey = MESES_KEY[idx % 12];
              colMeses[mesKey] = ci;
              achou++;
            }
          });
          if (achou >= 2) { headerIdx = i; break; }
        }

        if (headerIdx < 0 || Object.keys(colMeses).length === 0) {
          // Tenta formato alternativo: apenas 2 colunas (nome, valor)
          syncSetStatus('‚ö†Ô∏è N√£o encontrei colunas de meses no CSV. Formato esperado: linhas com nome + colunas Jan, Fev, etc.', 'warn');
          syncSetProgress(null);
          return;
        }

        syncSetProgress(60, `Header na linha ${headerIdx+1}, meses: ${Object.keys(colMeses).join(', ')}`);

        // Mapeia nome normalizado ‚Üí item de dadosFinanceiros
        const itemMap = {};
        ['receitas','impostos','custos','despesas','ebitda','ebitda_ajustado','ajustes','bancos'].forEach(cat => {
          (dadosFinanceiros[cat] || []).forEach(item => {
            const chave = item.nome.toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ').trim();
            itemMap[chave] = item;
          });
        });

        let atualizados = 0;
        const log = [];

        for (let i = headerIdx + 1; i < rows.length; i++) {
          const row = rows[i];
          if (!row[0] || row[0].trim() === '') continue;

          const nomeNorm = row[0].toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ').trim();

          // Busca exata ou parcial
          let item = itemMap[nomeNorm];
          if (!item) {
            item = Object.entries(itemMap).find(([k]) =>
              nomeNorm.startsWith(k.slice(0,8)) || k.startsWith(nomeNorm.slice(0,8))
            )?.[1];
          }
          if (!item) continue;

          // Aplica valores dos meses
          let algumValor = false;
          Object.entries(colMeses).forEach(([mesKey, ci]) => {
            const raw = (row[ci] || '').replace(/\./g,'').replace(',','.').replace(/[^\d\-\.]/g,'');
            const val = parseFloat(raw);
            if (!isNaN(val)) { item[mesKey] = val; algumValor = true; }
          });

          // Total (√∫ltima coluna com valor ou coluna 'total')
          if (algumValor) {
            const vals = Object.values(colMeses).map(ci => {
              const raw = (row[ci]||'').replace(/\./g,'').replace(',','.').replace(/[^\d\-\.]/g,'');
              return parseFloat(raw) || 0;
            });
            item.total = vals.reduce((s,v)=>s+v,0);
            atualizados++;
            log.push(item.nome);
          }
        }

        syncSetProgress(90, 'Salvando no Supabase...');
        await sbStorage.set('consolidado_dados', JSON.stringify(dadosFinanceiros));
        syncMarcarFeito();

        // Refresh
        showTab(document.querySelector('.tab-btn.active')?.textContent?.toLowerCase() || 'receitas');
        renderComissao();
        syncSetProgress(null);

        if (atualizados === 0) {
          syncSetStatus(`‚ö†Ô∏è Arquivo lido mas nenhuma categoria foi reconhecida. Verifique se os nomes batem com o sistema.`, 'warn');
        } else {
          syncSetStatus(`‚úÖ ${atualizados} categorias atualizadas via ${fonte}: ${log.slice(0,4).join(', ')}${log.length>4?'...':''}`, 'ok');
        }

      } catch(err) {
        syncSetProgress(null);
        syncSetStatus(`‚ùå Erro: ${err.message}`, 'erro');
        console.error('CSV parse error:', err);
      }
    }

    // Auto-fetch na primeira visita do dia
    const DADOS_VERSION = '2026-v5'; // Incrementar sempre que os dados hardcoded mudarem

    async function consolidadoInicializar() {
      syncAtualizarStatusUI();

      // Restaura dados salvos do Supabase
      try {
        const savedVersion = await sbStorage.get('consolidado_versao');
        const saved = await sbStorage.get('consolidado_dados');

        if (savedVersion === DADOS_VERSION && saved) {
          const parsed = JSON.parse(saved);
          Object.assign(dadosFinanceiros, parsed);
          syncSetStatus(`‚úÖ Dados carregados do Supabase (vers√£o ${DADOS_VERSION})`, 'ok');
        } else {
          // Vers√£o nova ‚Äî salva vers√£o atual, usa dados hardcoded
          await sbStorage.set('consolidado_versao', DADOS_VERSION);
          syncSetStatus('‚ö° Dados atualizados. Fa√ßa upload do XLSX para sincronizar meses futuros.', 'info');
        }
      } catch(e) {
        console.warn('consolidadoInicializar erro:', e);
      }
    }

    // ==================== INIT ====================
    document.addEventListener('DOMContentLoaded', async () => {
      // Define m√™s e ano atual como padr√£o nos seletores da Comiss√£o
      const hoje = new Date();
      const mesFiltro = document.getElementById('comissaoMesFiltro');
      const anoFiltro = document.getElementById('comissaoAnoFiltro');
      if (mesFiltro) mesFiltro.value = String(hoje.getMonth()); // 0=Jan, 1=Fev...
      if (anoFiltro) anoFiltro.value = String(hoje.getFullYear());

      await carregarParams();
      renderizarGraficos();
      consolidadoInicializar();
    });
  </script>
</body>
</html>
